

#

> æ³¨æ„ 1 ï¼Œè¿™ä¸ªé¢è¯•é¢˜ï¼Œæš‚æ—¶ä¸åŒ…æ‹¬ Spring MVC éƒ¨åˆ†ã€‚ä¸»è¦ä»¥ Spring IoCã€Spring AOPã€Spring Transaction ä¸ºä¸»ã€‚
>
> æ³¨æ„ 2 ï¼Œé¢è¯•å¾ˆå¤šéƒ½ä¸å¤ªé—®

Spring æ˜¯ä¸€ä¸ªå¾ˆåºå¤§çš„æŠ€æœ¯ä½“ç³»ï¼Œå¯ä»¥è¯´åŒ…å®¹ä¸€åˆ‡ï¼Œæ‰€ä»¥æœ¬æ–‡æˆ‘ä»¬æŒ‰ç…§ä¸‹é¢çš„é¡ºåºï¼Œç½—åˆ—å„ç§é¢è¯•é¢˜ï¼š 

- Spring **æ•´ä½“ **ç›¸å…³çš„é¢è¯•
- Spring **IoC** ç›¸å…³çš„é¢è¯•é¢˜
- Spring **AOP** ç›¸å…³çš„é¢è¯•é¢˜
- Spring **Transaction** ç›¸å…³çš„é¢è¯•é¢˜
- Spring **Data Access** ç›¸å…³çš„é¢è¯•é¢˜



# ä¸€ã€Spring æ•´ä½“

## 1. ä»€ä¹ˆæ˜¯ Spring Frameworkï¼Ÿ

Spring æ˜¯ä¸€ä¸ªå¼€æºåº”ç”¨æ¡†æ¶ï¼Œæ—¨åœ¨é™ä½åº”ç”¨ç¨‹åºå¼€å‘çš„å¤æ‚åº¦ã€‚

- å®ƒæ˜¯è½»é‡çº§ã€æ¾æ•£è€¦åˆçš„ã€‚

> å®ƒçš„è½»é‡çº§ä¸»è¦æ˜¯ç›¸å¯¹äº EJB ã€‚éšç€ Spring çš„ä½“ç³»è¶Šæ¥è¶Šåºå¤§ï¼Œå¤§å®¶è¢« Spring çš„é…ç½®ææ‡µé€¼äº†ï¼Œæ‰€ä»¥åæ¥å‡ºäº† Spring Boot ã€‚

- å®ƒå…·æœ‰åˆ†å±‚ä½“ç³»ç»“æ„ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©ç»„ä»¶ï¼ŒåŒæ—¶è¿˜ä¸º J2EE åº”ç”¨ç¨‹åºå¼€å‘æä¾›äº†ä¸€ä¸ªæœ‰å‡èšåŠ›çš„æ¡†æ¶ã€‚
- å®ƒå¯ä»¥é›†æˆå…¶ä»–æ¡†æ¶ï¼Œå¦‚ Spring MVCã€Hibernateã€MyBatis ç­‰ï¼Œæ‰€ä»¥åˆç§°ä¸ºæ¡†æ¶çš„æ¡†æ¶( ç²˜åˆå‰‚ã€è„šæ‰‹æ¶ )ã€‚

## 2. Spring Framework ä¸­æœ‰å¤šå°‘ä¸ªæ¨¡å—ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

å¦‚ä¸‹æ˜¯ä¸€å¼ æ¯”è¾ƒæ—©æœŸç‰ˆæœ¬çš„ Spring Framework çš„æ¨¡å—å›¾ï¼š

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/01.jpg)

### Spring æ ¸å¿ƒå®¹å™¨ï¼ˆCore Containerï¼‰

è¯¥å±‚åŸºæœ¬ä¸Šæ˜¯ Spring Framework çš„æ ¸å¿ƒã€‚å®ƒåŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š

- Spring Core
- Spring Bean

> æ ¸å¿ƒå®¹å™¨æä¾› Spring æ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ã€‚æ ¸å¿ƒå®¹å™¨çš„ä¸»è¦ç»„ä»¶æ˜¯ BeanFactoryï¼Œå®ƒæ˜¯å·¥å‚æ¨¡å¼çš„å®ç°ã€‚BeanFactory ä½¿ç”¨æ§åˆ¶åè½¬ ï¼ˆIOCï¼‰æ¨¡å¼å°†åº”ç”¨ç¨‹åºçš„é…ç½®å’Œä¾èµ–æ€§è§„èŒƒä¸å®é™…çš„åº”ç”¨ç¨‹åºä»£ç åˆ†å¼€ã€‚



- Spring Context

> Spring ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘ Spring æ¡†æ¶æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚Spring ä¸Šä¸‹æ–‡åŒ…æ‹¬ä¼ä¸šæœåŠ¡ï¼Œä¾‹å¦‚ JNDIã€EJBã€ç”µå­é‚®ä»¶ã€å›½é™…åŒ–ã€äº‹ä»¶æœºåˆ¶ã€æ ¡éªŒå’Œè°ƒåº¦åŠŸèƒ½ã€‚



- SpEL (Spring Expression Language)

> Spring è¡¨è¾¾å¼è¯­è¨€å…¨ç§°ä¸º â€œSpring Expression Languageâ€ï¼Œç¼©å†™ä¸º â€œSpELâ€ ï¼Œç±»ä¼¼äº Struts2 ä¸­ä½¿ç”¨çš„ OGNL è¡¨è¾¾å¼è¯­è¨€ï¼Œèƒ½åœ¨è¿è¡Œæ—¶æ„å»ºå¤æ‚è¡¨è¾¾å¼ã€å­˜å–å¯¹è±¡å›¾å±æ€§ã€å¯¹è±¡æ–¹æ³•è°ƒç”¨ç­‰ç­‰ï¼Œå¹¶ä¸”èƒ½ä¸ Spring åŠŸèƒ½å®Œç¾æ•´åˆï¼Œå¦‚èƒ½ç”¨æ¥é…ç½® Bean å®šä¹‰ã€‚



æˆ–è€…è¯´ï¼Œè¿™å—å°±æ˜¯ Spring IoC ã€‚

### æ•°æ®è®¿é—®ï¼ˆData Accessï¼‰

è¯¥å±‚æä¾›ä¸æ•°æ®åº“äº¤äº’çš„æ”¯æŒã€‚å®ƒåŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š

- JDBC ï¼ˆJava DataBase Connectivityï¼‰ï¼šSpring å¯¹ JDBC çš„å°è£…æ¨¡å—ï¼Œæä¾›äº†å¯¹å…³ç³»æ•°æ®åº“çš„è®¿é—®ã€‚

- ORM ï¼ˆObject Relational Mappingï¼‰ï¼šSpring ORM æ¨¡å—ï¼Œæä¾›äº†å¯¹ hibernate5 å’Œ JPA çš„é›†æˆã€‚
  - hibernate5 æ˜¯ä¸€ä¸ª ORM æ¡†æ¶ã€‚
  - JPA æ˜¯ä¸€ä¸ª Java æŒä¹…åŒ– API ã€‚


- OXM (Object XML Mappers)

> Spring æä¾›äº†ä¸€å¥—ç±»ä¼¼ ORM çš„æ˜ å°„æœºåˆ¶ï¼Œç”¨æ¥å°† Java å¯¹è±¡å’Œ XML æ–‡ä»¶è¿›è¡Œæ˜ å°„ã€‚è¿™å°±æ˜¯ Spring çš„å¯¹è±¡ XML æ˜ å°„åŠŸèƒ½ï¼Œæœ‰æ—¶å€™ä¹Ÿæˆä¸º XML çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚
>
> ç”¨çš„æ¯”è¾ƒå°‘ï¼Œèƒ–å‹äº†è§£ä¸‹å³å¯ã€‚

- Transactionï¼šSpring ç®€å•è€Œå¼ºå¤§çš„äº‹åŠ¡ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å£°æ˜å¼äº‹åŠ¡å’Œç¼–ç¨‹å¼äº‹åŠ¡ã€‚

### Web

è¯¥å±‚æä¾›äº†åˆ›å»º Web åº”ç”¨ç¨‹åºçš„æ”¯æŒã€‚å®ƒåŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š

- WebMVC

> MVC æ¡†æ¶æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„æ„å»º Web åº”ç”¨ç¨‹åºçš„ MVC å®ç°ã€‚é€šè¿‡ç­–ç•¥æ¥å£ï¼ŒMVC æ¡†æ¶å˜æˆä¸ºé«˜åº¦å¯é…ç½®çš„ï¼ŒMVC å®¹çº³äº†å¤§é‡è§†å›¾æŠ€æœ¯ï¼Œå…¶ä¸­åŒ…æ‹¬ JSPã€Velocityã€Tilesã€iText å’Œ POIã€‚

- WebFluxï¼šåŸºäº Reactive åº“çš„å“åº”å¼çš„ Web å¼€å‘æ¡†æ¶
  - ä¸äº†è§£å¯ä»¥çœ‹çœ‹ [ã€Šä½¿ç”¨ Spring 5 çš„ WebFlux å¼€å‘ååº”å¼ Web åº”ç”¨ã€‹](https://www.ibm.com/developerworks/cn/java/spring5-webflux-reactive/index.html)


- WebSocket
  - Spring 4.0 çš„ä¸€ä¸ªæœ€å¤§æ›´æ–°æ˜¯å¢åŠ äº†å¯¹ Websocket çš„æ”¯æŒã€‚
  - Websocket æä¾›äº†ä¸€ä¸ªåœ¨ Web åº”ç”¨ä¸­å®ç°é«˜æ•ˆã€åŒå‘é€šè®¯ï¼Œéœ€è€ƒè™‘å®¢æˆ·ç«¯(æµè§ˆå™¨)å’ŒæœåŠ¡ç«¯ä¹‹é—´é«˜é¢‘å’Œä½å»¶æ—¶æ¶ˆæ¯äº¤æ¢çš„æœºåˆ¶ã€‚
  - ä¸€èˆ¬çš„åº”ç”¨åœºæ™¯æœ‰ï¼šåœ¨çº¿äº¤æ˜“ã€ç½‘é¡µèŠå¤©ã€æ¸¸æˆã€åä½œã€æ•°æ®å¯è§†åŒ–ç­‰ã€‚

- ~~Portlet~~ å·²ç»åºŸå¼ƒ

### AOP

è¯¥å±‚æ”¯æŒé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚å®ƒåŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š

- AOP

> é€šè¿‡é…ç½®ç®¡ç†ç‰¹æ€§ï¼ŒSpring AOP æ¨¡å—ç›´æ¥å°†é¢å‘æ–¹é¢çš„ç¼–ç¨‹åŠŸèƒ½é›†æˆåˆ°äº† Spring æ¡†æ¶ä¸­ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ Spring æ¡†æ¶ç®¡ç†çš„ä»»ä½•å¯¹è±¡æ”¯æŒ AOPã€‚
>
> Spring AOP æ¨¡å—ä¸ºåŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡æä¾›äº†äº‹åŠ¡ç®¡ç†æœåŠ¡ã€‚é€šè¿‡ä½¿ç”¨ Spring AOPï¼Œä¸ç”¨ä¾èµ– EJB ç»„ä»¶ï¼Œå°±å¯ä»¥å°†å£°æ˜æ€§äº‹åŠ¡ç®¡ç†é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

- Aspectsï¼šè¯¥æ¨¡å—ä¸ºä¸ AspectJ çš„é›†æˆæä¾›æ”¯æŒã€‚

- Instrumentationï¼šè¯¥å±‚ä¸ºç±»æ£€æµ‹å’Œç±»åŠ è½½å™¨å®ç°æä¾›æ”¯æŒã€‚ç”¨çš„æ¯”è¾ƒå°‘ï¼Œäº†è§£ä¸‹å³å¯ã€‚

### å…¶å®ƒ

- JMS (Java Messaging Service)ï¼šæä¾›äº†ä¸€ä¸ª JMS é›†æˆæ¡†æ¶ï¼Œç®€åŒ–äº† JMS API çš„ä½¿ç”¨ã€‚
  - äº†è§£ JMS å¯ä»¥çœ‹çœ‹ [ã€ŠJMS(Javaæ¶ˆæ¯æœåŠ¡)å…¥é—¨æ•™ç¨‹ã€‹](https://www.cnblogs.com/chenpi/p/5559349.html) ã€‚


- Testï¼šè¯¥æ¨¡å—ä¸ºä½¿ç”¨ JUnit å’Œ TestNG è¿›è¡Œæµ‹è¯•æä¾›æ”¯æŒã€‚

- Messaging

> è¯¥æ¨¡å—ä¸º STOMP æä¾›æ”¯æŒã€‚å®ƒè¿˜æ”¯æŒæ³¨è§£ç¼–ç¨‹æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ç”¨äºä» WebSocket å®¢æˆ·ç«¯è·¯ç”±å’Œå¤„ç† STOMP æ¶ˆæ¯ã€‚

## 3. ä½¿ç”¨ Spring æ¡†æ¶èƒ½å¸¦æ¥å“ªäº›å¥½å¤„ï¼Ÿ

- **DI** ï¼š**[Dependency Injection(DI)](http://howtodoinjava.com/2013/03/19/inversion-of-control-ioc-and-dependency-injection-di-patterns-in-spring-framework-and-related-interview-questions/)** æ–¹æ³•ï¼Œä½¿å¾—æ„é€ å™¨å’Œ JavaBeanã€properties æ–‡ä»¶ä¸­çš„ä¾èµ–å…³ç³»ä¸€ç›®äº†ç„¶ã€‚
- **è½»é‡çº§**ï¼šä¸ EJB å®¹å™¨ç›¸æ¯”è¾ƒï¼ŒIoC å®¹å™¨æ›´åŠ è¶‹å‘äº**è½»é‡çº§**ã€‚è¿™æ ·ä¸€æ¥ IoC å®¹å™¨åœ¨æœ‰é™çš„å†…å­˜å’Œ CPU èµ„æºçš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œåº”ç”¨ç¨‹åºçš„å¼€å‘å’Œå‘å¸ƒå°±å˜å¾—ååˆ†æœ‰åˆ©ã€‚
- **é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP)**ï¼š Spring æ”¯æŒé¢å‘**åˆ‡é¢ç¼–ç¨‹**ï¼ŒåŒæ—¶æŠŠåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ä¸ç³»ç»Ÿçš„æœåŠ¡åˆ†ç¦»å¼€æ¥ã€‚
- **é›†æˆä¸»æµæ¡†æ¶**ï¼šSpring å¹¶æ²¡æœ‰é—­é—¨é€ è½¦ï¼ŒSpring **é›†æˆ**äº†å·²æœ‰çš„æŠ€æœ¯æ ˆï¼Œæ¯”å¦‚ ORM æ¡†æ¶ã€Logging æ—¥æœŸæ¡†æ¶ã€J2EEã€Quartz å’Œ JDK Timer ï¼Œä»¥åŠå…¶ä»–è§†å›¾æŠ€æœ¯ã€‚
- æ¨¡å—åŒ–ï¼šSpring æ¡†æ¶æ˜¯æŒ‰ç…§**æ¨¡å—**çš„å½¢å¼æ¥ç»„ç»‡çš„ã€‚ç”±åŒ…å’Œç±»çš„å‘½åï¼Œå°±å¯ä»¥çœ‹å‡ºå…¶æ‰€å±çš„æ¨¡å—ï¼Œå¼€å‘è€…ä»…ä»…éœ€è¦é€‰ç”¨ä»–ä»¬éœ€è¦çš„æ¨¡å—å³å¯ã€‚
- **ä¾¿æ·çš„æµ‹è¯•**ï¼šè¦ [æµ‹è¯•ä¸€é¡¹ç”¨Springå¼€å‘çš„åº”ç”¨ç¨‹åº](http://howtodoinjava.com/2013/04/19/how-to-unit-test-spring-security-authentication-with-junit/) ååˆ†ç®€å•ï¼Œå› ä¸º**æµ‹è¯•**ç›¸å…³çš„ç¯å¢ƒä»£ç éƒ½å·²ç»å›Šæ‹¬åœ¨æ¡†æ¶ä¸­äº†ã€‚æ›´åŠ ç®€å•çš„æ˜¯ï¼Œåˆ©ç”¨ JavaBean å½¢å¼çš„ POJO ç±»ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ©ç”¨ä¾èµ–æ³¨å…¥æ¥å†™å…¥æµ‹è¯•æ•°æ®ã€‚
- **Web æ¡†æ¶**ï¼šSpring çš„ **Web æ¡†æ¶**äº¦æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ Web MVC æ¡†æ¶ï¼Œä¸ºå¼€å‘è€…ä»¬åœ¨ Web æ¡†æ¶çš„é€‰æ‹©ä¸Šæä¾›äº†ä¸€ä¸ªé™¤äº†ä¸»æµæ¡†æ¶æ¯”å¦‚ Struts ã€è¿‡åº¦è®¾è®¡çš„ã€ä¸æµè¡Œ Web æ¡†æ¶çš„ä»¥å¤–çš„æœ‰åŠ›é€‰é¡¹ã€‚
- **äº‹åŠ¡ç®¡ç†**ï¼šSpring æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„**äº‹åŠ¡ç®¡ç†**æ¥å£ï¼Œé€‚ç”¨äºå°å‹çš„æœ¬åœ°äº‹ç‰©å¤„ç†ï¼ˆæ¯”å¦‚åœ¨å• DB çš„ç¯å¢ƒä¸‹ï¼‰å’Œå¤æ‚çš„å…±åŒäº‹ç‰©å¤„ç†ï¼ˆæ¯”å¦‚åˆ©ç”¨ JTA çš„å¤æ‚ DB ç¯å¢ƒï¼‰ã€‚
- **å¼‚å¸¸å¤„ç†**ï¼šSpring æä¾›ä¸€ä¸ªæ–¹ä¾¿çš„ API ï¼Œå°†ç‰¹å®šæŠ€æœ¯çš„å¼‚å¸¸(ç”±JDBC, Hibernate, æˆ– JDO æŠ›å‡º)è½¬åŒ–ä¸ºä¸€è‡´çš„ã€Unchecked å¼‚å¸¸ã€‚


å½“ç„¶ï¼ŒSpring å¸¦æ¥ä¼˜ç‚¹çš„åŒæ—¶ï¼Œä¸€å®šä¼šå¸¦æ¥ç›¸åº”çš„ç¼ºç‚¹ï¼š

- æ¯ä¸ªæ¡†æ¶éƒ½æœ‰çš„é—®é¢˜ï¼Œè°ƒè¯•é˜¶æ®µä¸ç›´è§‚ï¼ŒåæœŸçš„ bug å¯¹åº”é˜¶æ®µï¼Œä¸å®¹æ˜“åˆ¤æ–­é—®é¢˜æ‰€åœ¨ã€‚è¦èŠ±ä¸€å®šçš„æ—¶é—´å»ç†è§£å®ƒã€‚
- æŠŠå¾ˆå¤š JavaEE çš„ä¸œè¥¿å°è£…äº†ï¼Œåœ¨æ»¡è¶³å¿«é€Ÿå¼€å‘é«˜è´¨é‡ç¨‹åºçš„åŒæ—¶ï¼Œéšè—äº†å®ç°ç»†èŠ‚ã€‚

> è¿™å°±å¯¼è‡´ï¼Œå¾ˆå¤šå·¥ç¨‹å¸ˆï¼Œç¦»å¼€äº† Spring ä¹‹åï¼Œå°±ä¸çŸ¥é“æ€ä¹ˆå·¥ä½œäº†ã€‚ä» Java å·¥ç¨‹å¸ˆï¼Œå˜æˆäº† Spring å·¥ç¨‹å¸ˆã€‚å¯¹äºæœ‰è¿½æ±‚çš„æˆ‘ä»¬ï¼Œè¿˜æ˜¯éœ€è¦çŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚



## 4. Spring æ¡†æ¶ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ

Spring æ¡†æ¶ä¸­ä½¿ç”¨åˆ°äº†å¤§é‡çš„è®¾è®¡æ¨¡å¼ï¼Œä¸‹é¢åˆ—ä¸¾äº†æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ï¼š

- ä»£ç†æ¨¡å¼ â€” åœ¨ AOP å’Œ remoting ä¸­è¢«ç”¨çš„æ¯”è¾ƒå¤šã€‚
- å•ä¾‹æ¨¡å¼ â€” åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ Bean é»˜è®¤ä¸ºå•ä¾‹æ¨¡å¼ã€‚
- æ¨¡æ¿æ–¹æ³• â€” ç”¨æ¥è§£å†³ä»£ç é‡å¤çš„é—®é¢˜ã€‚æ¯”å¦‚ [RestTemplate](http://howtodoinjava.com/2015/02/20/spring-restful-client-resttemplate-example/)ã€JmsTemplateã€JdbcTemplate ã€‚
- å‰ç«¯æ§åˆ¶å™¨ â€” Springæä¾›äº† DispatcherServlet æ¥å¯¹è¯·æ±‚è¿›è¡Œåˆ†å‘ã€‚
- è§†å›¾å¸®åŠ©(View Helper) â€” Spring æä¾›äº†ä¸€ç³»åˆ—çš„ JSP æ ‡ç­¾ï¼Œé«˜æ•ˆå®æ¥è¾…åŠ©å°†åˆ†æ•£çš„ä»£ç æ•´åˆåœ¨è§†å›¾é‡Œã€‚
- ä¾èµ–æ³¨å…¥ â€” è´¯ç©¿äº BeanFactory / ApplicationContext æ¥å£çš„æ ¸å¿ƒç†å¿µã€‚
- å·¥å‚æ¨¡å¼ â€” BeanFactory ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„å®ä¾‹ã€‚



å½“ç„¶ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè§‰å¾—ä¸è¿‡ç˜¾ï¼Œå¯ä»¥çœ‹çœ‹çŸ¥ç§‹å†™çš„å‡ ç¯‡æ–‡ç« ï¼š

- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(ä¸€)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-1)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(äºŒ)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-2)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(ä¸‰)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-3)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(å››)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-4)
- [ã€ŠSpring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(äº”)ã€‹](http://www.iocoder.cn/Spring/DesignPattern-5)

# äºŒã€Spring IoC

> ä¸‹é¢ï¼Œæˆ‘ä»¬ä¼šå°†åˆ†æˆ IoC å’Œ Bean ä¸¤éƒ¨åˆ†æ¥åˆ†äº« Spring å®¹å™¨çš„å†…å®¹ã€‚
>
> - IoC ï¼Œä¾§é‡åœ¨äºå®¹å™¨ã€‚
> - Bean ï¼Œä¾§é‡åœ¨äºè¢«å®¹å™¨ç®¡ç†çš„ Bean ã€‚



## 5. ä»€ä¹ˆæ˜¯ Spring IoC å®¹å™¨ï¼Ÿ

> æ³¨æ„ï¼Œæ­£ç¡®çš„æ‹¼å†™æ˜¯ IoC ã€‚



Spring æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ Spring IoC å®¹å™¨ã€‚å®¹å™¨åˆ›å»º Bean å¯¹è±¡ï¼Œå°†å®ƒä»¬è£…é…åœ¨ä¸€èµ·ï¼Œé…ç½®å®ƒä»¬å¹¶ç®¡ç†å®ƒä»¬çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚



- Spring å®¹å™¨ä½¿ç”¨**ä¾èµ–æ³¨å…¥**æ¥ç®¡ç†ç»„æˆåº”ç”¨ç¨‹åºçš„ Bean å¯¹è±¡ã€‚
- å®¹å™¨é€šè¿‡è¯»å–æä¾›çš„**é…ç½®å…ƒæ•°æ®** Bean Definition æ¥æ¥æ”¶å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼Œé…ç½®å’Œç»„è£…çš„æŒ‡ä»¤ã€‚
- è¯¥é…ç½®å…ƒæ•°æ® Bean Definition å¯ä»¥é€šè¿‡ XMLï¼ŒJava æ³¨è§£æˆ– Java Config ä»£ç **æä¾›**ã€‚

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/image-20220325212105135.png)



## 6. ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection ï¼Œç®€ç§° DIï¼‰ï¼Ÿ

åœ¨ä¾èµ–æ³¨å…¥ä¸­ï¼Œä½ ä¸å¿…ä¸»åŠ¨ã€æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡ï¼Œä½†å¿…é¡»æè¿°å¦‚ä½•åˆ›å»ºå®ƒä»¬ã€‚

- ä½ ä¸æ˜¯ç›´æ¥åœ¨ä»£ç ä¸­å°†ç»„ä»¶å’ŒæœåŠ¡è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯æè¿°é…ç½®æ–‡ä»¶ä¸­å“ªäº›ç»„ä»¶éœ€è¦å“ªäº›æœåŠ¡ã€‚
- ç„¶åï¼Œå†ç”± IoC å®¹å™¨å°†å®ƒä»¬è£…é…åœ¨ä¸€èµ·ã€‚

## 7. IoC å’Œ DI æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- å¼•ç”¨çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªè®¨è®ºï¼š[ã€ŠIoC å’ŒDI æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿã€‹](https://www.zhihu.com/question/25392984)

- IoC æ˜¯ä¸ªæ›´å®½æ³›çš„æ¦‚å¿µï¼ŒDI æ˜¯æ›´å…·ä½“çš„ã€‚å¼•ç”¨éƒ‘çƒ¨çš„ä¸€ç¯‡åšå®¢ï¼Œ[æˆ‘çœ¼ä¸­çš„Spring](https://link.zhihu.com/?target=http%3A//dreamhead.blogbus.com/logs/125334.html)

> **Dependency Injection**
>
> åŸæ¥ï¼Œå®ƒå« IoC ã€‚Martin Flower å‘è¯äº†ï¼Œæ˜¯ä¸ªæ¡†æ¶éƒ½æœ‰ IoC ï¼Œè¿™ä¸è¶³ä»¥æ–°ç”Ÿå®¹å™¨åè½¬çš„â€œå¦‚ä½•å®šä½æ’ä»¶çš„å…·ä½“å®ç°â€ï¼Œäºæ˜¯ï¼Œå®ƒæœ‰äº†ä¸ªæ–°åå­—ï¼ŒDependency Injection ã€‚
>
> å…¶å®ï¼Œå®ƒå°±æ˜¯ä¸€ç§å°†è°ƒç”¨è€…ä¸è¢«è°ƒç”¨è€…åˆ†ç¦»çš„æ€æƒ³ï¼ŒUncle Bob ç®¡å®ƒå«DIPï¼ˆDependency Inversion Principleï¼‰ï¼Œå¹¶æŠŠå®ƒå½’å…¥OOè®¾è®¡åŸåˆ™ã€‚
> åŒ Spring ç›¸æ¯”ï¼Œå®ƒæ›´æ—©è¿›å…¥æˆ‘çš„å¤§è„‘ã€‚ä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆæœ¦èƒ§ï¼Œç›´è‡³ Spring å‡ºç°ã€‚æ…¢æ…¢çš„ï¼Œæˆ‘çŸ¥é“äº†å®ƒè¿˜åˆ†ä¸ºä¸‰ç§ï¼š
>
> - Interface Injectionï¼ˆtype 1ï¼‰
> - Setter Injectionï¼ˆtype 2ï¼‰
> - Constructor Injectionï¼ˆtype 3ï¼‰ã€‚
>
> Martin Floweré‚£ç¯‡ä¸ºå®ƒæ›´åçš„å¤§ä½œè®©æˆ‘å¿ƒç›®å…³äºå®ƒçš„ä¸€åˆ‡è¶‹äºå®Œæ•´ã€‚
>
> åœ¨ Spring ä¸­ï¼Œå®ƒæ˜¯ä¸€åˆ‡çš„åŸºç¡€ã€‚Spring çš„ç§ç§ä¼˜åŠ¿éšä¹‹è€Œæ¥ã€‚äºæˆ‘è€Œè¨€ï¼Œå®ƒä¸ºæˆ‘å¸¦æ¥æ›´å¤šçš„æ˜¯æ€ç»´æ–¹å¼çš„è½¬å˜ï¼Œææ€•ä»¥åæˆ‘å†ä¹Ÿæ— æ³•å†™å‡ºé‚£ç§ä¸€å¤§å—çš„å…¨åŠŸèƒ½ç¨‹åºäº†ã€‚

## 8. ä¾èµ–æ³¨å…¥çš„3ç§æ–¹å¼ï¼Ÿ

- æ¥å£æ³¨å…¥
- æ„é€ å‡½æ•°æ³¨å…¥
- setter æ³¨å…¥ï¼ˆå®é™…åœºæ™¯ä½¿ç”¨çš„æ›´å¤šï¼‰

ç›®å‰ï¼Œåœ¨ Spring Framework ä¸­ï¼Œä»…ä½¿ç”¨æ„é€ å‡½æ•°å’Œ setter æ³¨å…¥è¿™**ä¸¤ç§**æ–¹å¼ã€‚

é‚£ä¹ˆè¿™ä¸¤ç§æ–¹å¼å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹å‘¢ï¼Ÿå¯ä»¥ç®€å•é˜…è¯» [ã€ŠSpringä¸¤ç§ä¾èµ–æ³¨å…¥æ–¹å¼çš„æ¯”è¾ƒã€‹](https://my.oschina.net/itblog/blog/203746)ã€‚å¯¹æ¯”ä¸‹ï¼š

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/image-20220325212541886.png?w=600)



## 9. Spring ä¸­æœ‰å¤šå°‘ ã€ç§ã€‘ IoC å®¹å™¨ï¼Ÿ

Spring æä¾›äº†ä¸¤ç§( ä¸æ˜¯â€œä¸ªâ€ ) IoC å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯ BeanFactoryã€ApplicationContext ã€‚

BeanFactory ä¹Ÿè¢«ç§°ä¸º**ä½çº§**å®¹å™¨ï¼Œè€Œ ApplicationContext è¢«ç§°ä¸º**é«˜çº§**å®¹å™¨ã€‚

### 9.1 BeanFactory

- BeanFactory åœ¨ `spring-beans` é¡¹ç›®æä¾›ã€‚

- BeanFactory ï¼Œå°±åƒä¸€ä¸ªåŒ…å« Bean é›†åˆçš„å·¥å‚ç±»ã€‚å®ƒä¼šåœ¨å®¢æˆ·ç«¯è¦æ±‚æ—¶å®ä¾‹åŒ– Bean å¯¹è±¡ã€‚



### 9.2 ApplicationContext

- ApplicationContext åœ¨ `spring-context` é¡¹ç›®æä¾›ã€‚

- ApplicationContext æ¥å£æ‰©å±•äº† BeanFactory æ¥å£ï¼Œå®ƒåœ¨ BeanFactory åŸºç¡€ä¸Šæä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚å†…ç½®å¦‚ä¸‹åŠŸèƒ½ï¼š

  - MessageSource ï¼šç®¡ç† message ï¼Œå®ç°å›½é™…åŒ–ç­‰åŠŸèƒ½ã€‚

  - ApplicationEventPublisher ï¼šäº‹ä»¶å‘å¸ƒã€‚

  - ResourcePatternResolver ï¼šå¤šèµ„æºåŠ è½½ã€‚

  - EnvironmentCapable ï¼šç³»ç»Ÿ Environmentï¼ˆprofile + Propertiesï¼‰ç›¸å…³ã€‚

  - Lifecycle ï¼šç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚

  - Closable ï¼šå…³é—­ï¼Œé‡Šæ”¾èµ„æº

  - InitializingBeanï¼šè‡ªå®šä¹‰åˆå§‹åŒ–ã€‚

  - BeanNameAwareï¼šè®¾ç½® beanName çš„ Aware æ¥å£ã€‚


- å¦å¤–ï¼ŒApplicationContext ä¼šè‡ªåŠ¨åˆå§‹åŒ–éæ‡’åŠ è½½çš„ Bean å¯¹è±¡ä»¬ã€‚

- è¯¦ç»†çš„å†…å®¹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šã€æ­»ç£• Springã€‘â€”â€” ApplicationContext ç›¸å…³æ¥å£æ¶æ„åˆ†æã€‹](http://svip.iocoder.cn/Spring/ApplicationContext/) ä¸€æ–‡ã€‚æºç ä¹‹å‰æ— ç§˜å¯†ã€‚ç®€å•æ€»ç»“ä¸‹ BeanFactory ä¸ ApplicationContext ä¸¤è€…çš„å·®å¼‚ï¼š

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/image-20220325150047943.png)



## 10. è¯·ä»‹ç»ä¸‹å¸¸ç”¨çš„ BeanFactory å®¹å™¨ï¼Ÿ

BeanFactory æœ€å¸¸ç”¨çš„æ˜¯ XmlBeanFactory ã€‚å®ƒå¯ä»¥æ ¹æ® XML æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹ï¼Œåˆ›å»ºç›¸åº”çš„ Beanã€‚



## 11. è¯·ä»‹ç»ä¸‹å¸¸ç”¨çš„ ApplicationContext å®¹å™¨ï¼Ÿ

- ClassPathXmlApplicationContext ï¼šä» ClassPath çš„ XML é…ç½®æ–‡ä»¶ä¸­è¯»å–ä¸Šä¸‹æ–‡ï¼Œå¹¶ç”Ÿæˆä¸Šä¸‹æ–‡å®šä¹‰ã€‚åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä»ç¨‹åºç¯å¢ƒå˜é‡ä¸­å–å¾—ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

  ```java
  ApplicationContext context = new ClassPathXmlApplicationContext("bean.xml");
  ```

- FileSystemXmlApplicationContext ï¼šç”±æ–‡ä»¶ç³»ç»Ÿä¸­çš„XMLé…ç½®æ–‡ä»¶è¯»å–ä¸Šä¸‹æ–‡ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

  ```java
  ApplicationContext context = new FileSystemXmlApplicationContext("bean.xml");
  ```

- XmlWebApplicationContext ï¼šç”± Web åº”ç”¨çš„XMLæ–‡ä»¶è¯»å–ä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨ Spring MVC ä½¿ç”¨çš„æƒ…å†µã€‚

- ConfigServletWebServerApplicationContextï¼šSpring Boot ä¸ºä¸»


## 12. åˆ—ä¸¾ä¸€äº› IoC çš„ä¸€äº›å¥½å¤„ï¼Ÿ

- å®ƒå°†æœ€å°åŒ–åº”ç”¨ç¨‹åºä¸­çš„ä»£ç é‡ã€‚
- å®ƒä»¥æœ€å°çš„å½±å“å’Œæœ€å°‘çš„ä¾µå…¥æœºåˆ¶ä¿ƒè¿›æ¾è€¦åˆã€‚
- å®ƒæ”¯æŒå³æ—¶çš„å®ä¾‹åŒ–å’Œå»¶è¿ŸåŠ è½½ Bean å¯¹è±¡ã€‚
- å®ƒå°†ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºæ˜“äºæµ‹è¯•ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å•å…ƒæµ‹è¯•ç”¨ä¾‹ä¸­çš„ä»»ä½•å•ä¾‹æˆ– JNDI æŸ¥æ‰¾æœºåˆ¶ã€‚



## 13. ç®€è¿° Spring IoC çš„å®ç°æœºåˆ¶ï¼Ÿ

- å·¥å‚æ¨¡å¼ + åå°„æœºåˆ¶

```java
interface Fruit {
     public abstract void eat();
}
// Fruit æ¥å£ï¼Œæœ‰ Apple å’Œ Orange ä¸¤ä¸ªå®ç°ç±»ã€‚
class Apple implements Fruit {
    public void eat(){
        System.out.println("Apple");
    }
}
class Orange implements Fruit {
    public void eat(){
        System.out.println("Orange");
    }
}
// Factory å·¥å‚ï¼Œé€šè¿‡åå°„æœºåˆ¶ï¼Œåˆ›å»º `className` å¯¹åº”çš„ Fruit å¯¹è±¡ã€‚
class Factory {
    public static Fruit getInstance(String className) {
        Fruit f = null;
        try {
            f = (Fruit) Class.forName(className).newInstance();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return f;
    }
}
// Client é€šè¿‡ Factory å·¥å‚ï¼Œè·å¾—å¯¹åº”çš„ Fruit å¯¹è±¡ã€‚
class Client {
    public static void main(String[] args) {
        Fruit f = Factory.getInstance("io.github.dunwu.spring.Apple");
        if(f != null){
            f.eat();
        }
    } 
}
```

- ğŸ˜ˆ å®é™…æƒ…å†µä¸‹ï¼ŒSpring IoC æ¯”è¿™ä¸ªå¤æ‚å¾ˆå¤šå¾ˆå¤šï¼Œä¾‹å¦‚å•ä¾‹ Bean å¯¹è±¡ï¼ŒBean çš„å±æ€§æ³¨å…¥ï¼Œç›¸äº’ä¾èµ–çš„ Bean çš„å¤„ç†ï¼Œä»¥åŠç­‰ç­‰ã€‚

 [ã€Šé¢è¯•é—®çƒ‚çš„ Spring IoC è¿‡ç¨‹ã€‹](http://www.iocoder.cn/Fight/Interview-poorly-asked-Spring-IOC-process-1/) çš„æ–‡ç« ä¸­ï¼ŒæŠŠ Spring IoC ç›¸å…³çš„å†…å®¹ï¼Œè®²çš„éå¸¸ä¸é”™ã€‚



## 14. Spring æ¡†æ¶ä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Ÿ

Spring çš„ ApplicationContext æä¾›äº†æ”¯æŒäº‹ä»¶å’Œä»£ç ä¸­ç›‘å¬å™¨çš„åŠŸèƒ½ã€‚

æˆ‘ä»¬å¯ä»¥åˆ›å»º Bean ç”¨æ¥ç›‘å¬åœ¨ ApplicationContext ä¸­å‘å¸ƒçš„äº‹ä»¶ã€‚å¦‚æœä¸€ä¸ª Bean å®ç°äº† ApplicationListener æ¥å£ï¼Œå½“ä¸€ä¸ªApplicationEvent è¢«å‘å¸ƒä»¥åï¼ŒBean ä¼šè‡ªåŠ¨è¢«é€šçŸ¥ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
public class AllApplicationEventListener implements ApplicationListener<ApplicationEvent> {    
    @Override  
    public void onApplicationEvent(ApplicationEvent applicationEvent) {  
        // process event  
    }
}
```



- Spring æä¾›äº†ä»¥ä¸‹äº”ç§æ ‡å‡†çš„äº‹ä»¶ï¼š

  - ä¸Šä¸‹æ–‡æ›´æ–°äº‹ä»¶ï¼ˆContextRefreshedEventï¼‰ï¼šè¯¥äº‹ä»¶ä¼šåœ¨ApplicationContext è¢«åˆå§‹åŒ–æˆ–è€…æ›´æ–°æ—¶å‘å¸ƒã€‚ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ConfigurableApplicationContext æ¥å£ä¸­çš„ <font color=red>`#refresh()` </font>æ–¹æ³•æ—¶è¢«è§¦å‘ã€‚

  - ä¸Šä¸‹æ–‡å¼€å§‹äº‹ä»¶ï¼ˆContextStartedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContext çš„ `#start()` æ–¹æ³•å¼€å§‹/é‡æ–°å¼€å§‹å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚

  - ä¸Šä¸‹æ–‡åœæ­¢äº‹ä»¶ï¼ˆContextStoppedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ ConfigurableApplicationContext çš„ `#stop()` æ–¹æ³•åœæ­¢å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚

  - ä¸Šä¸‹æ–‡å…³é—­äº‹ä»¶ï¼ˆContextClosedEventï¼‰ï¼šå½“ApplicationContext è¢«å…³é—­æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚å®¹å™¨è¢«å…³é—­æ—¶ï¼Œå…¶ç®¡ç†çš„æ‰€æœ‰å•ä¾‹ Bean éƒ½è¢«é”€æ¯ã€‚

  - è¯·æ±‚å¤„ç†äº‹ä»¶ï¼ˆRequestHandledEventï¼‰ï¼šåœ¨ We båº”ç”¨ä¸­ï¼Œå½“ä¸€ä¸ªHTTP è¯·æ±‚ï¼ˆrequestï¼‰ç»“æŸè§¦å‘è¯¥äº‹ä»¶ã€‚

- é™¤äº†ä¸Šé¢ä»‹ç»çš„äº‹ä»¶ä»¥å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰©å±• ApplicationEvent ç±»æ¥å¼€å‘**è‡ªå®šä¹‰**çš„äº‹ä»¶ã€‚

â‘  ç¤ºä¾‹è‡ªå®šä¹‰çš„äº‹ä»¶çš„ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
public class CustomApplicationEvent extends ApplicationEvent{  
    public CustomApplicationEvent(Object source, final String msg) {  
        super(source);
    }  
}
```

â‘¡ ä¸ºäº†ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
public class CustomEventListener implements ApplicationListener<CustomApplicationEvent> {
    @Override  
    public void onApplicationEvent(CustomApplicationEvent applicationEvent) {  
        // handle event  
    } 
}
```

â‘¢ ä¹‹åé€šè¿‡ ApplicationContext æ¥å£çš„ `#publishEvent(Object event)` æ–¹æ³•ï¼Œæ¥å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
// åˆ›å»º CustomApplicationEvent äº‹ä»¶
CustomApplicationEvent customEvent = new CustomApplicationEvent(applicationContext, "Test message");
// å‘å¸ƒäº‹ä»¶
applicationContext.publishEvent(customEvent);
```



# ä¸‰ã€Spring Bean

## 15. ä»€ä¹ˆæ˜¯ Spring Bean ï¼Ÿ

- Bean ç”± Spring IoC å®¹å™¨å®ä¾‹åŒ–ï¼Œé…ç½®ï¼Œè£…é…å’Œç®¡ç†ã€‚
- Bean æ˜¯åŸºäºç”¨æˆ·æä¾›ç»™ IoC å®¹å™¨çš„é…ç½®å…ƒæ•°æ® Bean Definition åˆ›å»ºã€‚

è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨å›è¿‡å¤´çœ‹ [ã€Œä»€ä¹ˆæ˜¯ Spring IoC å®¹å™¨ï¼Ÿã€](http://svip.iocoder.cn/Spring/Interview/#) é—®é¢˜ï¼Œç›¸äº’å¯¹ç…§ã€‚

## 16. Spring æœ‰å“ªäº›é…ç½®æ–¹å¼

å•çº¯ä» Spring Framework æä¾›çš„æ–¹å¼ï¼Œä¸€å…±æœ‰ä¸‰ç§ï¼š

- 1ã€XML é…ç½®æ–‡ä»¶ã€‚

Bean æ‰€éœ€çš„ä¾èµ–é¡¹å’ŒæœåŠ¡åœ¨ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šã€‚è¿™äº›é…ç½®æ–‡ä»¶é€šå¸¸åŒ…å«è®¸å¤š bean å®šä¹‰å’Œç‰¹å®šäºåº”ç”¨ç¨‹åºçš„é…ç½®é€‰é¡¹ã€‚å®ƒä»¬é€šå¸¸ä»¥ bean æ ‡ç­¾å¼€å¤´ã€‚ä¾‹å¦‚ï¼š

```xml
<bean id="studentBean" class="org.edureka.firstSpring.StudentBean">
    <property name="name" value="Edureka"></property>
</bean>
```



- 2ã€æ³¨è§£é…ç½®ã€‚

æ‚¨å¯ä»¥é€šè¿‡åœ¨ç›¸å…³çš„ç±»ï¼Œæ–¹æ³•æˆ–å­—æ®µå£°æ˜ä¸Šä½¿ç”¨æ³¨è§£ï¼Œå°† Bean é…ç½®ä¸ºç»„ä»¶ç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ XML æ¥æè¿° Bean è£…é…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å®¹å™¨ä¸­æœªæ‰“å¼€æ³¨è§£è£…é…ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦åœ¨ä½¿ç”¨å®ƒä¹‹å‰åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å¯ç”¨å®ƒã€‚ä¾‹å¦‚ï¼š

```xml
<beans>
<context:annotation-config/>
<!-- bean definitions go here -->
</beans>
```

- 3ã€Java Config é…ç½®ã€‚

Spring çš„ Java é…ç½®æ˜¯é€šè¿‡ä½¿ç”¨ @Bean å’Œ @Configuration æ¥å®ç°ã€‚

- `@Bean` æ³¨è§£æ‰®æ¼”ä¸ `<bean />` å…ƒç´ ç›¸åŒçš„è§’è‰²ã€‚
- `@Configuration` ç±»å…è®¸é€šè¿‡ç®€å•åœ°è°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„å…¶ä»– `@Bean` æ–¹æ³•æ¥å®šä¹‰ Bean é—´ä¾èµ–å…³ç³»ã€‚

```java
@Configuration
public class StudentConfig {
    @Bean
    public StudentBean myStudent() {
        return new StudentBean();
    }
}
```

ç›®å‰ä¸»è¦ä½¿ç”¨ **Java Config** é…ç½®ä¸ºä¸»ã€‚å½“ç„¶ï¼Œä¸‰ç§é…ç½®æ–¹å¼æ˜¯å¯ä»¥æ··åˆä½¿ç”¨çš„ã€‚ä¾‹å¦‚è¯´ï¼š

- Dubbo æœåŠ¡çš„é…ç½®ï¼Œå–œæ¬¢ä½¿ç”¨ XML ã€‚
- Spring MVC è¯·æ±‚çš„é…ç½®ï¼Œå–œæ¬¢ä½¿ç”¨ `@RequestMapping` æ³¨è§£ã€‚
- Spring MVC æ‹¦æˆªå™¨çš„é…ç½®ï¼Œå–œæ¬¢ Java Config é…ç½®ã€‚


å¦å¤–ï¼Œç°åœ¨å·²ç»æ˜¯ Spring Boot çš„å¤©ä¸‹ï¼Œæ‰€ä»¥æ›´åŠ æ˜¯ **Java Config** é…ç½®ä¸ºä¸»ã€‚

## 17. Spring æ”¯æŒå‡ ç§ Bean Scope ï¼Ÿï¼ˆ5ç§ï¼Œäº†è§£å³å¯ï¼‰

- Singleton - æ¯ä¸ª Spring IoC å®¹å™¨ä»…æœ‰ä¸€ä¸ªå• Bean å®ä¾‹ã€‚ï¼ˆé»˜è®¤ï¼‰
- Prototype - æ¯æ¬¡è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚
- Request - æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼Œå¹¶ä¸”è¯¥ Bean ä»…åœ¨å½“å‰ HTTP è¯·æ±‚å†…æœ‰æ•ˆã€‚
- Session - æ¯ä¸€ä¸ªçš„ Session éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼ŒåŒæ—¶è¯¥ Bean ä»…åœ¨å½“å‰ HTTP Session å†…æœ‰æ•ˆã€‚
- Application - æ¯ä¸€ä¸ª Web Application éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Bean ï¼ŒåŒæ—¶è¯¥ Bean ä»…åœ¨å½“å‰ Web Application å†…æœ‰æ•ˆã€‚

> å¦å¤–ï¼Œç½‘ç»œä¸Šå¾ˆå¤šæ–‡ç« è¯´æœ‰ Global-session çº§åˆ«ï¼Œå®ƒæ˜¯ Portlet æ¨¡å—ç‹¬æœ‰ï¼Œç›®å‰å·²ç»åºŸå¼ƒï¼Œåœ¨ Spring5 ä¸­æ˜¯æ‰¾ä¸åˆ°çš„ã€‚



ä»…å½“ç”¨æˆ·ä½¿ç”¨æ”¯æŒ Web çš„ ApplicationContext æ—¶ï¼Œ**æœ€åä¸‰ä¸ªæ‰å¯ç”¨**ã€‚

å†è¡¥å……ä¸€ç‚¹ï¼Œå¼€å‘è€…æ˜¯å¯ä»¥**è‡ªå®šä¹‰** Bean Scope ï¼Œå…·ä½“å¯å‚è§ [ã€ŠSpringï¼ˆ10ï¼‰â€”â€” Bean ä½œç”¨èŒƒå›´ï¼ˆäºŒï¼‰â€”â€” è‡ªå®šä¹‰ Scopeã€‹](https://blog.csdn.net/elim168/article/details/75581670) ã€‚

ä¸é”™å‘¢ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œè¿™ä¸ªé¢˜ç›®ç®€å•äº†è§£ä¸‹å³å¯ï¼Œå®é™…å¸¸ç”¨çš„åªæœ‰ Singleton å’Œ Prototype ä¸¤ç§çº§åˆ«ï¼Œç”šè‡³è¯´ï¼Œåªæœ‰ Singleton çº§åˆ«ã€‚ğŸ˜ˆ



## 18. Spring Bean åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

> è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé«˜çº§çš„ Spring çš„é¢è¯•é¢˜ï¼Œéå¸¸å¸¸è§ï¼Œå¹¶ä¸”ç­”å¯¹æ¯”è¾ƒåŠ åˆ†ã€‚å½“ç„¶ï¼Œå¦‚æœå®é™…çœŸæ­£å¼„æ‡‚ï¼Œéœ€è¦å¯¹ Spring Bean çš„æºç ï¼Œæœ‰æ¯”è¾ƒå¥½çš„ç†è§£ï¼Œæ‰€ä»¥ [ã€Šç²¾å°½ Spring æºç ã€‹](http://svip.iocoder.cn/categories/Spring/) ç³»åˆ—ï¼Œè¯¥è¯»è¿˜æ˜¯è¯»å§ã€‚



Spring Bean çš„**åˆå§‹åŒ–**æµç¨‹å¦‚ä¸‹ï¼š

- å®ä¾‹åŒ– Bean å¯¹è±¡

  - Spring å®¹å™¨æ ¹æ®é…ç½®ä¸­çš„ Bean Definition(å®šä¹‰)ä¸­**å®ä¾‹åŒ–** Bean å¯¹è±¡ã€‚

    > Bean Definition å¯ä»¥é€šè¿‡ XMLï¼ŒJava æ³¨è§£æˆ– Java Config ä»£ç æä¾›ã€‚

  - Spring ä½¿ç”¨ä¾èµ–æ³¨å…¥**å¡«å……**æ‰€æœ‰å±æ€§ï¼Œå¦‚ Bean ä¸­æ‰€å®šä¹‰çš„é…ç½®ã€‚

- Aware ç›¸å…³çš„å±æ€§ï¼Œæ³¨å…¥åˆ° Bean å¯¹è±¡

  - å¦‚æœ Bean å®ç° **BeanNameAware** æ¥å£ï¼Œåˆ™å·¥å‚é€šè¿‡ä¼ é€’ Bean çš„ beanName æ¥è°ƒç”¨ `#setBeanName(String name)` æ–¹æ³•ã€‚
  - å¦‚æœ Bean å®ç° **BeanFactoryAware** æ¥å£ï¼Œå·¥å‚é€šè¿‡ä¼ é€’è‡ªèº«çš„å®ä¾‹æ¥è°ƒç”¨ `#setBeanFactory(BeanFactory beanFactory)` æ–¹æ³•ã€‚

- è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ï¼Œè¿›ä¸€æ­¥åˆå§‹åŒ– Bean å¯¹è±¡

  - å¦‚æœå­˜åœ¨ä¸ Bean å…³è”çš„ä»»ä½• **BeanPostProcessor** ä»¬ï¼Œåˆ™è°ƒç”¨ `#preProcessBeforeInitialization(Object bean, String beanName)` æ–¹æ³•ã€‚
  - å¦‚æœ Bean å®ç° **InitializingBean** æ¥å£ï¼Œåˆ™ä¼šè°ƒç”¨ `#afterPropertiesSet()` æ–¹æ³•ã€‚
  - å¦‚æœä¸º Bean æŒ‡å®šäº† **init** æ–¹æ³•ï¼ˆä¾‹å¦‚ `<bean />` çš„ `init-method` å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå°†è°ƒç”¨è¯¥æ–¹æ³•ã€‚
  - å¦‚æœå­˜åœ¨ä¸ Bean å…³è”çš„ä»»ä½• **BeanPostProcessor** ä»¬ï¼Œåˆ™å°†è°ƒç”¨ `#postProcessAfterInitialization(Object bean, String beanName)` æ–¹æ³•ã€‚




Spring Bean çš„**é”€æ¯**æµç¨‹å¦‚ä¸‹ï¼š

- å¦‚æœ Bean å®ç° **DisposableBean** æ¥å£ï¼Œå½“ spring å®¹å™¨å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨ `#destroy()` æ–¹æ³•ã€‚
- å¦‚æœä¸º bean æŒ‡å®šäº† **destroy** æ–¹æ³•ï¼ˆä¾‹å¦‚ `<bean />` çš„ `destroy-method` å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå°†è°ƒç”¨è¯¥æ–¹æ³•ã€‚

æ•´ä½“å¦‚ä¸‹å›¾ï¼š

![](http://static.iocoder.cn/images/Spring/2018-12-24/03.jpg)

æ— æ„ä¸­ï¼Œåˆç¿»åˆ°ä¸€å¼ æœ‰è¶£çš„æ•´ä½“å›¾ï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/08.jpeg)[



## 19. ä»€ä¹ˆæ˜¯ Spring çš„å†…éƒ¨ beanï¼Ÿ

åªæœ‰å°† Bean **ä»…**ç”¨ä½œå¦ä¸€ä¸ª Bean çš„å±æ€§æ—¶ï¼Œæ‰èƒ½å°† Bean å£°æ˜ä¸ºå†…éƒ¨ Beanã€‚

 

- ä¸ºäº†å®šä¹‰ Beanï¼ŒSpring æä¾›åŸºäº XML çš„é…ç½®å…ƒæ•°æ®åœ¨ `<property>`æˆ– `<constructor-arg>` ä¸­æä¾›äº† `<bean>`å…ƒç´ çš„ä½¿ç”¨ã€‚
- å†…éƒ¨ Bean æ€»æ˜¯**åŒ¿å**çš„ï¼Œå¹¶ä¸”å®ƒä»¬æ€»æ˜¯ä½œä¸º**åŸå‹ Prototype** ã€‚



ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Student ç±»ï¼Œå…¶ä¸­å¼•ç”¨äº† Person ç±»ã€‚è¿™é‡Œæˆ‘ä»¬å°†åªåˆ›å»ºä¸€ä¸ª Person ç±»å®ä¾‹å¹¶åœ¨ Student ä¸­ä½¿ç”¨å®ƒã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
public class Student {
    private Person person;
    // ... Setters and Getters
}
public class Person {
    private String name;
    private String address;
    // ... Setters and Getters
}
```



```xml
<!-- bean.xml -->
<bean id=â€œStudentBean" class="com.edureka.Student">
    <property name="person">
        <!--This is inner bean -->
        <bean class="com.edureka.Person">
            <property name="name" value=â€œScott"></property>
            <property name="address" value=â€œBangalore"></property>
        </bean>
    </property>
</bean>
```



## 20. ä»€ä¹ˆæ˜¯ Spring è£…é…ï¼Ÿ

å½“ Bean åœ¨ Spring å®¹å™¨ä¸­ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œå®ƒè¢«ç§°ä¸º**è£…é…**æˆ– **Bean è£…é…**ã€‚Spring å®¹å™¨éœ€è¦çŸ¥é“éœ€è¦ä»€ä¹ˆ Bean ä»¥åŠå®¹å™¨åº”è¯¥å¦‚ä½•ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥å°† Bean ç»‘å®šåœ¨ä¸€èµ·ï¼ŒåŒæ—¶è£…é… Bean ã€‚

> è£…é…ï¼Œå’Œä¸Šæ–‡æåˆ°çš„ DI ä¾èµ–æ³¨å…¥ï¼Œå®é™…æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚



**è‡ªåŠ¨è£…é…æœ‰å“ªäº›æ–¹å¼ï¼Ÿ**

Spring å®¹å™¨èƒ½å¤Ÿè‡ªåŠ¨è£…é… Bean ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ BeanFactory çš„å†…å®¹è®© Spring è‡ªåŠ¨è§£æ Bean çš„åä½œè€…ã€‚

è‡ªåŠ¨è£…é…çš„ä¸åŒæ¨¡å¼ï¼š

- no - è¿™æ˜¯é»˜è®¤è®¾ç½®ï¼Œè¡¨ç¤ºæ²¡æœ‰è‡ªåŠ¨è£…é…ã€‚åº”ä½¿ç”¨æ˜¾å¼ Bean å¼•ç”¨è¿›è¡Œè£…é…ã€‚
- byName - å®ƒæ ¹æ® Bean çš„åç§°æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚å®ƒåŒ¹é…å¹¶è£…é…å…¶å±æ€§ä¸ XML æ–‡ä»¶ä¸­ç”±ç›¸åŒåç§°å®šä¹‰çš„ Bean ã€‚
- ã€æœ€å¸¸ç”¨ã€‘**byType** - å®ƒæ ¹æ®ç±»å‹æ³¨å…¥å¯¹è±¡ä¾èµ–é¡¹ã€‚å¦‚æœå±æ€§çš„ç±»å‹ä¸ XML æ–‡ä»¶ä¸­çš„ä¸€ä¸ª Bean ç±»å‹åŒ¹é…ï¼Œåˆ™åŒ¹é…å¹¶è£…é…å±æ€§ã€‚
- æ„é€ å‡½æ•° - å®ƒé€šè¿‡è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°æ¥æ³¨å…¥ä¾èµ–é¡¹ã€‚å®ƒæœ‰å¤§é‡çš„å‚æ•°ã€‚
- autodetect - é¦–å…ˆå®¹å™¨å°è¯•é€šè¿‡æ„é€ å‡½æ•°ä½¿ç”¨ autowire è£…é…ï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™å°è¯•é€šè¿‡ byType è‡ªåŠ¨è£…é…ã€‚



**è‡ªåŠ¨è£…é…æœ‰ä»€ä¹ˆå±€é™ï¼Ÿ**

> è¿™ä¸ªé¢˜ç›®ï¼Œäº†è§£ä¸‹å³å¯ï¼Œä¹Ÿä¸æ˜¯å¾ˆå‡†ç¡®ã€‚



- è¦†ç›–çš„å¯èƒ½æ€§ - æ‚¨å§‹ç»ˆå¯ä»¥ä½¿ç”¨ `<constructor-arg>` å’Œ `<property>` è®¾ç½®æŒ‡å®šä¾èµ–é¡¹ï¼Œè¿™å°†è¦†ç›–è‡ªåŠ¨è£…é…ã€‚
- åŸºæœ¬å…ƒæ•°æ®ç±»å‹ - ç®€å•å±æ€§ï¼ˆå¦‚åŸæ•°æ®ç±»å‹ï¼Œå­—ç¬¦ä¸²å’Œç±»ï¼‰æ— æ³•è‡ªåŠ¨è£…é…ã€‚

> è¿™ç§ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œä¹Ÿä¸èƒ½ç§°ä¸ºå±€é™ã€‚å› ä¸ºå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥è§£å†³ã€‚

- ä»¤äººå›°æƒ‘çš„æ€§è´¨ - æ€»æ˜¯å–œæ¬¢ä½¿ç”¨æ˜ç¡®çš„è£…é…ï¼Œå› ä¸ºè‡ªåŠ¨è£…é…ä¸å¤ªç²¾ç¡®ã€‚



### 21. è§£é‡Šä»€ä¹ˆå«å»¶è¿ŸåŠ è½½ï¼Ÿ

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å¯åŠ¨ä¹‹åä¼šå°†æ‰€æœ‰ä½œç”¨åŸŸä¸º**å•ä¾‹**çš„ Bean éƒ½åˆ›å»ºå¥½ï¼Œä½†æ˜¯æœ‰çš„ä¸šåŠ¡åœºæ™¯æˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒæå‰éƒ½åˆ›å»ºå¥½ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Bean ä¸­è®¾ç½® `lzay-init = "true"` ã€‚

 

- è¿™æ ·ï¼Œå½“å®¹å™¨å¯åŠ¨ä¹‹åï¼Œä½œç”¨åŸŸä¸ºå•ä¾‹çš„ Bean ï¼Œå°±ä¸åœ¨åˆ›å»ºã€‚
- è€Œæ˜¯åœ¨è·å¾—è¯¥ Bean æ—¶ï¼Œæ‰çœŸæ­£åœ¨åˆ›å»ºåŠ è½½ã€‚







### 22. Spring æ¡†æ¶ä¸­çš„å•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ä¹ˆï¼Ÿ

Spring æ¡†æ¶å¹¶æ²¡æœ‰å¯¹[å•ä¾‹](http://howtodoinjava.com/2012/10/22/singleton-design-pattern-in-java/) Bean è¿›è¡Œä»»ä½•å¤šçº¿ç¨‹çš„å°è£…å¤„ç†ã€‚

- å…³äºå•ä¾‹ Bean çš„[çº¿ç¨‹å®‰å…¨](http://howtodoinjava.com/2014/06/02/what-is-thread-safety/)å’Œå¹¶å‘é—®é¢˜ï¼Œéœ€è¦å¼€å‘è€…è‡ªè¡Œå»æå®šã€‚
- å¹¶ä¸”ï¼Œå•ä¾‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¹Ÿä¸æ˜¯ Spring åº”è¯¥å»å…³å¿ƒçš„ã€‚Spring åº”è¯¥åšçš„æ˜¯ï¼Œæä¾›æ ¹æ®é…ç½®ï¼Œåˆ›å»ºå•ä¾‹ Bean æˆ–å¤šä¾‹ Bean çš„åŠŸèƒ½ã€‚



å½“ç„¶ï¼Œä½†å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†çš„ Spring Bean å¹¶æ²¡æœ‰å¯å˜çš„çŠ¶æ€(æ¯”å¦‚Serview ç±»å’Œ DAO ç±»)ï¼Œæ‰€ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šè¯´ Spring çš„å•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚



å¦‚æœä½ çš„ Bean æœ‰å¤šç§çŠ¶æ€çš„è¯ï¼Œå°±éœ€è¦è‡ªè¡Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚æœ€æµ…æ˜¾çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯å°†å¤šæ€ Bean çš„ä½œç”¨åŸŸ( Scope )ç”± Singleton å˜æ›´ä¸º Prototype ã€‚



### 23. Spring Bean æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Ÿ

> èƒ½å›ç­”å‡ºè¿™ä¸ªé—®é¢˜çš„ï¼Œä¸€èˆ¬æ˜¯æ¯”è¾ƒå‰å®³çš„ã€‚



è¿™æ˜¯ä¸ªæ¯”è¾ƒå¤æ‚çš„é—®é¢˜ï¼Œæœ‰èƒ½åŠ›çš„èƒ–å‹ï¼Œå»ºè®®çœ‹ä¸‹ [ã€Šã€æ­»ç£• Springã€‘â€”â€” IoC ä¹‹åŠ è½½ Beanï¼šåˆ›å»º Beanï¼ˆäº”ï¼‰ä¹‹å¾ªç¯ä¾èµ–å¤„ç†ã€‹](http://svip.iocoder.cn/Spring/IoC-get-Bean-createBean-5/)

æ„Ÿè§‰ï¼Œä¸é€šè¿‡æºç ï¼Œå¾ˆéš¾è§£é‡Šæ¸…æ¥šè¿™ä¸ªé—®é¢˜ã€‚å¦‚æœçœ‹ä¸æ‡‚çš„èƒ–å‹ï¼Œå¯ä»¥åœ¨è®¤çœŸçœ‹å®Œï¼Œåœ¨æ˜Ÿçƒé‡Œï¼Œæˆ‘ä»¬ä¸€èµ·å¤šäº¤æµä¸‹ã€‚å¥½ç©çš„ã€‚



# å››ã€Spring æ³¨è§£

è¿™å—å†…å®¹ï¼Œå®é™…å†™åœ¨ [ã€ŒSpring Beanã€](http://svip.iocoder.cn/Spring/Interview/#) ä¸­æ¯”è¾ƒåˆé€‚ï¼Œè€ƒè™‘åˆ°åç»­çš„é—®é¢˜ï¼Œéƒ½æ˜¯å…³äºæ³¨è§£çš„ï¼Œæ‰€ä»¥å•ç‹¬èµ·ä¸€ä¸ªå¤§çš„ç« èŠ‚ã€‚

## 24. ä»€ä¹ˆæ˜¯åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®ï¼Ÿ

ä¸ä½¿ç”¨ XML æ¥æè¿° Bean è£…é…ï¼Œå¼€å‘äººå‘˜é€šè¿‡åœ¨ç›¸å…³çš„ç±»ï¼Œæ–¹æ³•æˆ–å­—æ®µå£°æ˜ä¸Šä½¿ç”¨**æ³¨è§£**å°†é…ç½®ç§»åŠ¨åˆ°ç»„ä»¶ç±»æœ¬èº«ã€‚å®ƒå¯ä»¥ä½œä¸º XML è®¾ç½®çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼š

Spring çš„ Java é…ç½®æ˜¯é€šè¿‡ä½¿ç”¨ `@Bean` å’Œ `@Configuration` æ¥å®ç°ã€‚

- `@Bean` æ³¨è§£ï¼Œæ‰®æ¼”ä¸ `<bean />` å…ƒç´ ç›¸åŒçš„è§’è‰²ã€‚
- `@Configuration` æ³¨è§£çš„ç±»ï¼Œå…è®¸é€šè¿‡ç®€å•åœ°è°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„å…¶ä»– `@Bean` æ–¹æ³•æ¥å®šä¹‰ Bean é—´ä¾èµ–å…³ç³»ã€‚

ç¤ºä¾‹å¦‚ä¸‹ï¼š
```java
@Configuration
public class StudentConfig {
    @Bean
    public StudentBean myStudent() {
        return new StudentBean();
    }
}
```



## 25. å¦‚ä½•åœ¨ Spring ä¸­å¯åŠ¨æ³¨è§£è£…é…ï¼Ÿ

é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å®¹å™¨ä¸­æœªæ‰“å¼€æ³¨è§£è£…é…ã€‚å› æ­¤ï¼Œè¦ä½¿ç”¨åŸºäºæ³¨è§£è£…é…ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡é…ç½® `<contextï¼šannotation-config />` å…ƒç´ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å¯ç”¨å®ƒã€‚

å½“ç„¶ï¼Œå¦‚æœèƒ–å‹æ˜¯ä½¿ç”¨ Spring Boot ï¼Œé»˜è®¤æƒ…å†µä¸‹å·²ç»å¼€å¯ã€‚



## 26. @Component, @Controller, @Repository, @Service æœ‰ä½•åŒºåˆ«ï¼Ÿ

- `@Component` ï¼šå®ƒå°† Java ç±»æ ‡è®°ä¸º Bean ã€‚å®ƒæ˜¯ä»»ä½• Spring ç®¡ç†ç»„ä»¶çš„**é€šç”¨**æ„é€ å‹ã€‚
- `@Controller` ï¼šå®ƒå°†ä¸€ä¸ªç±»æ ‡è®°ä¸º Spring Web MVC **æ§åˆ¶å™¨**ã€‚
- `@Service` ï¼šæ­¤æ³¨è§£æ˜¯ç»„ä»¶æ³¨è§£çš„ç‰¹åŒ–ã€‚å®ƒä¸ä¼šå¯¹ `@Component` æ³¨è§£æä¾›ä»»ä½•å…¶ä»–è¡Œä¸ºã€‚æ‚¨å¯ä»¥åœ¨**æœåŠ¡å±‚**ç±»ä¸­ä½¿ç”¨ @Service è€Œä¸æ˜¯ `@Component` ï¼Œå› ä¸ºå®ƒä»¥æ›´å¥½çš„æ–¹å¼æŒ‡å®šäº†æ„å›¾ã€‚
- `@Repository` ï¼šè¿™ä¸ªæ³¨è§£æ˜¯å…·æœ‰ç±»ä¼¼ç”¨é€”å’ŒåŠŸèƒ½çš„ `@Component` æ³¨è§£çš„ç‰¹åŒ–ã€‚å®ƒä¸º **DAO** æä¾›äº†é¢å¤–çš„å¥½å¤„ã€‚å®ƒå°† DAO å¯¼å…¥ IoC å®¹å™¨ï¼Œå¹¶ä½¿æœªç»æ£€æŸ¥çš„å¼‚å¸¸æœ‰èµ„æ ¼è½¬æ¢ä¸º Spring DataAccessException ã€‚





## 27. @Required æ³¨è§£æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

`@Required` æ³¨è§£ï¼Œåº”ç”¨äº Bean å±æ€§ setter æ–¹æ³•ã€‚

- æ­¤æ³¨è§£ä»…æŒ‡ç¤ºå¿…é¡»åœ¨é…ç½®æ—¶ä½¿ç”¨ Bean å®šä¹‰ä¸­çš„æ˜¾å¼å±æ€§å€¼æˆ–ä½¿ç”¨è‡ªåŠ¨è£…é…å¡«å……å—å½±å“çš„ Bean å±æ€§ã€‚
- å¦‚æœå°šæœªå¡«å……å—å½±å“çš„ Bean å±æ€§ï¼Œåˆ™å®¹å™¨å°†æŠ›å‡º BeanInitializationException å¼‚å¸¸ã€‚



ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
public class Employee {

    private String name;
    
    @Required
    public void setName(String name){
        this.name=name;
    }
    
    public string getName(){
        return name;
    }
    
}
```

- T T è²Œä¼¼å¹³æ—¶å¾ˆå°‘ç”¨è¿™ä¸ªæ³¨è§£å™¢ã€‚



## 28. @Autowired æ³¨è§£æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

`@Autowired` æ³¨è§£ï¼Œå¯ä»¥æ›´å‡†ç¡®åœ°æ§åˆ¶åº”è¯¥åœ¨ä½•å¤„ä»¥åŠå¦‚ä½•è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚

- æ­¤æ³¨è§£ç”¨äºåœ¨ setter æ–¹æ³•ï¼Œæ„é€ å‡½æ•°ï¼Œå…·æœ‰ä»»æ„åç§°æˆ–å¤šä¸ªå‚æ•°çš„å±æ€§æˆ–æ–¹æ³•ä¸Šè‡ªåŠ¨è£…é… Beanã€‚
- é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ç±»å‹é©±åŠ¨çš„æ³¨å…¥ã€‚



ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
public class EmpAccount {
    
    @Autowired
    private Employee emp;
    
}
```



## 29. @Qualifier æ³¨è§£æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

å½“ä½ åˆ›å»ºå¤šä¸ª**ç›¸åŒç±»å‹**çš„ Bean ï¼Œå¹¶å¸Œæœ›ä»…ä½¿ç”¨å±æ€§è£…é…**å…¶ä¸­ä¸€ä¸ª** Bean æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `@Qualifier` æ³¨è§£å’Œ `@Autowired` é€šè¿‡æŒ‡å®š ID åº”è¯¥è£…é…å“ªä¸ª**ç¡®åˆ‡çš„** Bean æ¥æ¶ˆé™¤æ­§ä¹‰ã€‚

ä¾‹å¦‚ï¼Œåº”ç”¨ä¸­æœ‰ä¸¤ä¸ªç±»å‹ä¸º Employee çš„ Bean ID ä¸º `"emp1"` å’Œ `"emp2"` ï¼Œæ­¤å¤„ï¼Œæˆ‘ä»¬å¸Œæœ› EmployeeAccount Bean æ³¨å…¥ `"emp1"` å¯¹åº”çš„ Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
public class EmployeeAccount {

    @Autowired
    @Qualifier(emp1)
    private Employee emp;

}
```



# äº”ã€Spring AOP

> å¤šæ¦‚å¿µé¢˜ï¼Œä¸»è¦æ˜¯å¯¹åˆ‡é¢çš„ç†è§£ã€‚å…³é”®è¯ï¼š
>
> - AOP
> - Aspect
> - JoinPoint
> - PointCut
> - Advice
> - Target
> - AOP Proxy
> - Weaving



éå¸¸æ¨èé˜…è¯»å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š

- [ã€Šå½»åº•å¾æœ Spring AOP ä¹‹ç†è®ºç¯‡ã€‹](https://segmentfault.com/a/1190000007469968)
- [ã€Šå½»åº•å¾æœ Spring AOP ä¹‹å®æˆ˜ç¯‡ã€‹](https://segmentfault.com/a/1190000007469982)



## 30. ä»€ä¹ˆæ˜¯ AOP ï¼Ÿ

AOPï¼ˆAspect-Oriented Programmingï¼‰ï¼Œå³**é¢å‘åˆ‡é¢ç¼–ç¨‹**, å®ƒä¸ OOP( Object-Oriented Programming, é¢å‘å¯¹è±¡ç¼–ç¨‹) ç›¸è¾…ç›¸æˆï¼Œ æä¾›äº†ä¸ OOP ä¸åŒçš„æŠ½è±¡è½¯ä»¶ç»“æ„çš„è§†è§’ã€‚

- åœ¨ OOP ä¸­ï¼Œä»¥ç±»( Class )ä½œä¸ºåŸºæœ¬å•å…ƒ
- åœ¨ AOP ä¸­ï¼Œä»¥**åˆ‡é¢( Aspect )**ä½œä¸ºåŸºæœ¬å•å…ƒã€‚



## 31. ä»€ä¹ˆæ˜¯ Aspect ï¼Ÿ

Aspect ç”± **PointCut** å’Œ **Advice** ç»„æˆã€‚



- å®ƒæ—¢åŒ…å«äº†æ¨ªåˆ‡é€»è¾‘çš„å®šä¹‰ï¼Œä¹ŸåŒ…æ‹¬äº†è¿æ¥ç‚¹çš„å®šä¹‰ã€‚
- Spring AOP å°±æ˜¯è´Ÿè´£å®æ–½åˆ‡é¢çš„æ¡†æ¶ï¼Œå®ƒå°†åˆ‡é¢æ‰€å®šä¹‰çš„æ¨ªåˆ‡é€»è¾‘ç¼–ç»‡åˆ°åˆ‡é¢æ‰€æŒ‡å®šçš„è¿æ¥ç‚¹ä¸­ã€‚



AOP çš„å·¥ä½œé‡å¿ƒåœ¨äºå¦‚ä½•å°†å¢å¼ºç¼–ç»‡ç›®æ ‡å¯¹è±¡çš„è¿æ¥ç‚¹ä¸Š, è¿™é‡ŒåŒ…å«ä¸¤ä¸ªå·¥ä½œ:

1. å¦‚ä½•é€šè¿‡ PointCut å’Œ Advice å®šä½åˆ°ç‰¹å®šçš„ **JoinPoint** ä¸Šã€‚
2. å¦‚ä½•åœ¨ Advice ä¸­ç¼–å†™åˆ‡é¢ä»£ç ã€‚

**å¯ä»¥ç®€å•åœ°è®¤ä¸º, ä½¿ç”¨ @Aspect æ³¨è§£çš„ç±»å°±æ˜¯åˆ‡é¢**

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/04.jpg)

## 32. ä»€ä¹ˆæ˜¯ JoinPoint ?

JoinPoint ï¼Œ**åˆ‡ç‚¹**ï¼Œç¨‹åºè¿è¡Œä¸­çš„ä¸€äº›æ—¶é—´ç‚¹, ä¾‹å¦‚ï¼š

- ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚
- æˆ–è€…æ˜¯ä¸€ä¸ªå¼‚å¸¸çš„å¤„ç†ã€‚



åœ¨ Spring AOP ä¸­ï¼ŒJoinPoint æ€»æ˜¯æ–¹æ³•çš„æ‰§è¡Œç‚¹ã€‚



## 33. ä»€ä¹ˆæ˜¯ PointCut ï¼Ÿ

PointCut ï¼Œ**åŒ¹é…** JoinPoint çš„è°“è¯(a predicate that matches join points)ã€‚

> ç®€å•æ¥è¯´ï¼ŒPointCut æ˜¯åŒ¹é… JoinPoint çš„æ¡ä»¶ã€‚

- Advice æ˜¯å’Œç‰¹å®šçš„ PointCut å…³è”çš„ï¼Œå¹¶ä¸”åœ¨ PointCut ç›¸åŒ¹é…çš„ JoinPoint ä¸­æ‰§è¡Œã€‚å³ `Advice => PointCut => JoinPoint` ã€‚
- åœ¨ Spring ä¸­, æ‰€æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ JoinPoint ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨æ‰€æœ‰çš„æ–¹æ³•ä¸Šéƒ½æ·»åŠ  Advice ã€‚**è€Œ PointCut çš„ä½œç”¨**ï¼Œå°±æ˜¯æä¾›ä¸€ç»„è§„åˆ™(ä½¿ç”¨ AspectJ PointCut expression language æ¥æè¿°) æ¥åŒ¹é… JoinPoint ï¼Œç»™æ»¡è¶³è§„åˆ™çš„ JoinPoint æ·»åŠ  Advice ã€‚

## 34. å…³äº JoinPoint å’Œ PointCut çš„åŒºåˆ«

JoinPoint å’Œ PointCut æœ¬è´¨ä¸Šå°±æ˜¯**ä¸¤ä¸ªä¸åŒçº¬åº¦ä¸Š**çš„ä¸œè¥¿ã€‚

- åœ¨ Spring AOP ä¸­ï¼Œæ‰€æœ‰çš„æ–¹æ³•æ‰§è¡Œéƒ½æ˜¯ JoinPoint ã€‚è€Œ PointCut æ˜¯ä¸€ä¸ªæè¿°ä¿¡æ¯ï¼Œå®ƒä¿®é¥°çš„æ˜¯ JoinPoint ï¼Œé€šè¿‡ PointCut ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šå“ªäº› JoinPoint å¯ä»¥è¢«ç»‡å…¥ Advice ã€‚
- Advice æ˜¯åœ¨ JoinPoint ä¸Šæ‰§è¡Œçš„ï¼Œè€Œ PointCut è§„å®šäº†å“ªäº› JoinPoint å¯ä»¥æ‰§è¡Œå“ªäº› Advice ã€‚

æˆ–è€…ï¼Œæˆ‘ä»¬åœ¨æ¢ä¸€ç§è¯´æ³•ï¼š

1. é¦–å…ˆï¼ŒAdvice é€šè¿‡ PointCut æŸ¥è¯¢éœ€è¦è¢«ç»‡å…¥çš„ JoinPoint ã€‚
2. ç„¶åï¼ŒAdvice åœ¨æŸ¥è¯¢åˆ° JoinPoint ä¸Šæ‰§è¡Œé€»è¾‘ã€‚



## 35. ä»€ä¹ˆæ˜¯ Adviceï¼ˆé€šçŸ¥ï¼‰ï¼Ÿ

- ç‰¹å®š JoinPoint å¤„çš„ Aspect æ‰€é‡‡å–çš„åŠ¨ä½œç§°ä¸º Advice ã€‚
- Spring AOP ä½¿ç”¨ä¸€ä¸ª Advice ä½œä¸ºæ‹¦æˆªå™¨ï¼Œåœ¨ JoinPoint â€œå‘¨å›´â€ç»´æŠ¤ä¸€ç³»åˆ—çš„**æ‹¦æˆªå™¨**ã€‚

**æœ‰å“ªäº›ç±»å‹çš„ Adviceï¼Ÿ**

- Before - è¿™äº›ç±»å‹çš„ Advice åœ¨ JoinPoint æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ `@Before` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚
- After Returning - è¿™äº›ç±»å‹çš„ Advice åœ¨è¿æ¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œåæ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ `@AfterReturning` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚
- After Throwing - è¿™äº›ç±»å‹çš„ Advice ä»…åœ¨ JoinPoint æ–¹æ³•é€šè¿‡æŠ›å‡ºå¼‚å¸¸é€€å‡ºå¹¶ä½¿ç”¨ `@AfterThrowing` æ³¨è§£æ ‡è®°é…ç½®æ—¶æ‰§è¡Œã€‚
- After Finally - è¿™äº›ç±»å‹çš„ Advice åœ¨è¿æ¥ç‚¹æ–¹æ³•ä¹‹åæ‰§è¡Œï¼Œæ— è®ºæ–¹æ³•é€€å‡ºæ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸è¿”å›ï¼Œå¹¶ä½¿ç”¨ `@After` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚
- Around - è¿™äº›ç±»å‹çš„ Advice åœ¨è¿æ¥ç‚¹ä¹‹å‰å’Œä¹‹åæ‰§è¡Œï¼Œå¹¶ä½¿ç”¨ `@Around` æ³¨è§£æ ‡è®°è¿›è¡Œé…ç½®ã€‚

ğŸ˜ˆ çœ‹èµ·æ¥ï¼Œæ˜¯ä¸æ˜¯å’Œæ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶é—´ï¼Œæœ‰å‡ åˆ†ç›¸ä¼¼ã€‚å®é™…ä¸Šï¼Œç”¨äºæ‹¦æˆªæ•ˆæœçš„å„ç§å®ç°ï¼Œå¤§ä½“éƒ½æ˜¯ç±»ä¼¼çš„ã€‚



## 36. ä»€ä¹ˆæ˜¯ Target ï¼Ÿ

Target ï¼Œç»‡å…¥ Advice çš„**ç›®æ ‡å¯¹è±¡**ã€‚ç›®æ ‡å¯¹è±¡ä¹Ÿè¢«ç§°ä¸º **Advised Object** ã€‚

- å› ä¸º Spring AOP ä½¿ç”¨è¿è¡Œæ—¶ä»£ç†çš„æ–¹å¼æ¥å®ç° Aspect ï¼Œå› æ­¤ Advised Object æ€»æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡(Proxied Object) ã€‚
- **æ³¨æ„, Advised Object æŒ‡çš„ä¸æ˜¯åŸæ¥çš„å¯¹è±¡ï¼Œè€Œæ˜¯ç»‡å…¥ Advice åæ‰€äº§ç”Ÿçš„ä»£ç†å¯¹è±¡**ã€‚
- Advice + Target Object = Advised Object = Proxy ã€‚



## 37. AOP æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿï¼ˆ2ï¼‰

#### â‘  **é™æ€ä»£ç†** - æŒ‡ä½¿ç”¨ AOP æ¡†æ¶æä¾›çš„å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œä»è€Œåœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ç”Ÿæˆ AOP ä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºç¼–è¯‘æ—¶å¢å¼ºã€‚

- ç¼–è¯‘æ—¶ç¼–ç»‡ï¼ˆç‰¹æ®Šç¼–è¯‘å™¨å®ç°ï¼‰
- ç±»åŠ è½½æ—¶ç¼–ç»‡ï¼ˆç‰¹æ®Šçš„ç±»åŠ è½½å™¨å®ç°ï¼‰ã€‚



> ä¾‹å¦‚ï¼ŒSkyWalking åŸºäº Java Agent æœºåˆ¶ï¼Œé…ç½®ä¸Š ByteBuddy åº“ï¼Œå®ç°ç±»åŠ è½½æ—¶ç¼–ç»‡æ—¶å¢å¼ºï¼Œä»è€Œå®ç°é“¾è·¯è¿½è¸ªçš„é€æ˜åŸ‹ç‚¹ã€‚
>
> å¯ä»¥çœ‹çœ‹ [ã€ŠSkyWalking æºç åˆ†æä¹‹ JavaAgent å·¥å…· ByteBuddy çš„åº”ç”¨ã€‹](http://www.kailing.pub/article/index/arcid/178.html) ã€‚



#### â‘¡ **åŠ¨æ€ä»£ç†** - åœ¨è¿è¡Œæ—¶åœ¨å†…å­˜ä¸­â€œä¸´æ—¶â€ç”Ÿæˆ AOP åŠ¨æ€ä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºè¿è¡Œæ—¶å¢å¼ºã€‚ç›®å‰ Spring ä¸­ä½¿ç”¨äº†ä¸¤ç§åŠ¨æ€ä»£ç†åº“ï¼š

- JDK åŠ¨æ€ä»£ç†
- CGLIB

é‚£ä¹ˆ Spring ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨ CGLIB å‘¢ï¼Ÿ

```java
// From ã€ŠSpring æºç æ·±åº¦è§£æã€‹P172
// Spring AOP éƒ¨åˆ†ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†æˆ–è€… CGLIB æ¥ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†ã€‚ï¼ˆå»ºè®®å°½é‡ä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼‰
// å¦‚æœè¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼Œåˆ™ä¼šä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚æ‰€æœ‰è¯¥ç›®æ ‡ç±»å‹å®ç°çš„æ¥å£éƒ½è®²è¢«ä»£ç†ã€‚
// è‹¥è¯¥ç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª CGLIB ä»£ç†ã€‚
// å¦‚æœä½ å¸Œæœ›å¼ºåˆ¶ä½¿ç”¨ CGLIB ä»£ç†ï¼Œï¼ˆä¾‹å¦‚å¸Œæœ›ä»£ç†ç›®æ ‡å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•ï¼Œè€Œä¸åªæ˜¯å®ç°è‡ªæ¥å£çš„æ–¹æ³•ï¼‰é‚£ä¹Ÿå¯ä»¥ã€‚ä½†æ˜¯éœ€è¦è€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼š
//      1> æ— æ³•é€šçŸ¥(advise) Final æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½è¢«è¦†ç›–ã€‚
//      2> ä½ éœ€è¦å°† CGLIB äºŒè¿›åˆ¶å‘å‹åŒ…æ”¾åœ¨ classpath ä¸‹é¢ã€‚
// ä¸ºä»€ä¹ˆ Spring é»˜è®¤ä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†å‘¢ï¼Ÿç¬”è€…çŒœæµ‹åŸå› å¦‚ä¸‹ï¼š
//      1> ä½¿ç”¨ JDK åŸç”Ÿæ”¯æŒï¼Œå‡å°‘ä¸‰æ–¹ä¾èµ–
//      2> JDK8 å¼€å§‹åï¼ŒJDK ä»£ç†çš„æ€§èƒ½å·®è· CGLIB çš„æ€§èƒ½ä¸ä¼šå¤ªå¤šã€‚å¯å‚è§ï¼šhttps://www.cnblogs.com/haiq/p/4304615.html
```



- å®é™…ä¸Šï¼ŒSpring AOP çš„ä»£ç é‡ä¸å¤§ï¼Œä¸å…¶åœ¨çª—æˆ·å¤–é¢ä¸æ¸…ä¸æ¥šï¼Œä¸å¦‚æ…ç ´å®ƒï¼ [ã€Šç²¾å°½ Spring æºç åˆ†æ â€”â€” AOP æºç ç®€å•å¯¼è¯»ã€‹](http://svip.iocoder.cn/Spring/aop-simple-intro/) ã€‚



æˆ–è€…ï¼Œæˆ‘ä»¬æ¥æ¢ä¸€ä¸ªè§£ç­”ç­”æ¡ˆï¼š

Spring AOP ä¸­çš„åŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œ

- JDK åŠ¨æ€ä»£ç†

  JDK åŠ¨æ€ä»£ç†é€šè¿‡åå°„æ¥æ¥æ”¶è¢«ä»£ç†çš„ç±»ï¼Œå¹¶ä¸”è¦æ±‚è¢«ä»£ç†çš„ç±»å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£ã€‚JDKåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ˜¯ InvocationHandler æ¥å£å’Œ Proxy ç±»ã€‚

- CGLIB åŠ¨æ€ä»£ç†

  å¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œé‚£ä¹ˆ Spring AOP ä¼šé€‰æ‹©ä½¿ç”¨ CGLIB æ¥åŠ¨æ€ä»£ç†ç›®æ ‡ç±»ã€‚å½“ç„¶ï¼ŒSpring ä¹Ÿæ”¯æŒé…ç½®ï¼Œ**å¼ºåˆ¶**ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ã€‚
  CGLIBï¼ˆCode Generation Libraryï¼‰ï¼Œæ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆçš„ç±»åº“ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„ç”ŸæˆæŸä¸ªç±»çš„å­ç±»ï¼Œæ³¨æ„ï¼ŒCGLIB æ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼åšçš„åŠ¨æ€ä»£ç†ï¼Œå› æ­¤å¦‚æœæŸä¸ªç±»è¢«æ ‡è®°ä¸º `final` ï¼Œé‚£ä¹ˆå®ƒæ˜¯æ— æ³•ä½¿ç”¨ CGLIB åšåŠ¨æ€ä»£ç†çš„ã€‚



## 38.Spring AOP and AspectJ AOP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- ä»£ç†æ–¹å¼ä¸åŒ
  - Spring AOP åŸºäºåŠ¨æ€ä»£ç†æ–¹å¼å®ç°ã€‚
  - AspectJ AOP åŸºäºé™æ€ä»£ç†æ–¹å¼å®ç°ã€‚
- PointCut æ”¯æŒåŠ›åº¦ä¸åŒ
  - Spring AOP **ä»…**æ”¯æŒæ–¹æ³•çº§åˆ«çš„ PointCut ã€‚
  - AspectJ AOP æä¾›äº†å®Œå…¨çš„ AOP æ”¯æŒï¼Œå®ƒè¿˜æ”¯æŒå±æ€§çº§åˆ«çš„ PointCut ã€‚



## 39. ä»€ä¹ˆæ˜¯ç¼–ç»‡ï¼ˆWeavingï¼‰ï¼Ÿ

- ä¸ºäº†åˆ›å»ºä¸€ä¸ª Advice å¯¹è±¡è€Œé“¾æ¥ä¸€ä¸ª Aspect å’Œå…¶å®ƒåº”ç”¨ç±»å‹æˆ–å¯¹è±¡ï¼Œç§°ä¸ºç¼–ç»‡ï¼ˆWeavingï¼‰ã€‚

- åœ¨ Spring AOP ä¸­ï¼Œç¼–ç»‡åœ¨è¿è¡Œæ—¶æ‰§è¡Œï¼Œå³åŠ¨æ€ä»£ç†ã€‚è¯·å‚è€ƒä¸‹å›¾ï¼š

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/05.jpg)

## 40. Spring å¦‚ä½•ä½¿ç”¨ AOP åˆ‡é¢ï¼Ÿ

åœ¨ Spring AOP ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼é…ç½® AOP åˆ‡é¢ï¼š

- åŸºäº **XML** æ–¹å¼çš„åˆ‡é¢å®ç°ã€‚
- åŸºäº **æ³¨è§£** æ–¹å¼çš„åˆ‡é¢å®ç°ã€‚

ç›®å‰ï¼Œä¸»æµå–œæ¬¢ä½¿ç”¨ **æ³¨è§£** æ–¹å¼ã€‚å¯ä»¥çœ‹çœ‹ [ã€Šå½»åº•å¾æœ Spring AOP ä¹‹å®æˆ˜ç¯‡ã€‹](https://segmentfault.com/a/1190000007469982) ã€‚



# å…­ã€Spring Transaction

éå¸¸æ¨èé˜…è¯»å¦‚ä¸‹æ–‡ç« ï¼š

- [ã€Šå¯èƒ½æ˜¯æœ€æ¼‚äº®çš„ Spring äº‹åŠ¡ç®¡ç†è¯¦è§£ã€‹](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247484702&idx=1&sn=c04261d63929db09ff6df7cadc7cca21&chksm=fa497aafcd3ef3b94082da7bca841b5b7b528eb2a52dbc4eb647b97be63a9a1cf38a9e71bf90&token=165108535&lang=zh_CN#rd)

## 41. ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ

äº‹åŠ¡å°±æ˜¯å¯¹ä¸€ç³»åˆ—çš„æ•°æ®åº“æ“ä½œï¼ˆæ¯”å¦‚æ’å…¥å¤šæ¡æ•°æ®ï¼‰è¿›è¡Œç»Ÿä¸€çš„æäº¤æˆ–å›æ»šæ“ä½œï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œé‚£ä¹ˆä¸€èµ·æˆåŠŸï¼Œå¦‚æœä¸­é—´æœ‰ä¸€æ¡å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆå›æ»šä¹‹å‰çš„æ‰€æœ‰æ“ä½œã€‚

è¿™æ ·å¯ä»¥é˜²æ­¢å‡ºç°è„æ•°æ®ï¼Œé˜²æ­¢æ•°æ®åº“æ•°æ®å‡ºç°é—®é¢˜ã€‚



## 42. äº‹åŠ¡çš„ç‰¹æ€§æŒ‡çš„æ˜¯ï¼ŸACID

![äº‹åŠ¡çš„ç‰¹æ€§](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/06.jpeg)



1. **åŸå­æ€§ï¼ˆAtomicity ï¼‰** ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«æ¢å¤ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚å³ï¼Œäº‹åŠ¡ä¸å¯åˆ†å‰²ã€ä¸å¯çº¦ç®€ã€‚
2. **ä¸€è‡´æ€§ï¼ˆConsistency ï¼‰** ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾[çº¦æŸ](https://zh.wikipedia.org/wiki/æ•°æ®å®Œæ•´æ€§)ã€[è§¦å‘å™¨](https://zh.wikipedia.org/wiki/è§¦å‘å™¨_(æ•°æ®åº“))ã€[çº§è”å›æ»š](https://zh.wikipedia.org/w/index.php?title=çº§è”å›æ»š&action=edit&redlink=1)ç­‰ã€‚
3. **éš”ç¦»æ€§ï¼ˆIsolation ï¼‰** ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚
4. **æŒä¹…æ€§ï¼ˆDurability ï¼‰** ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚



## 43. åˆ—ä¸¾ Spring æ”¯æŒçš„äº‹åŠ¡ç®¡ç†ç±»å‹ï¼Ÿ

ç›®å‰ Spring æä¾›ä¸¤ç§ç±»å‹çš„äº‹åŠ¡ç®¡ç†ï¼š

- **å£°æ˜å¼**äº‹åŠ¡ï¼šé€šè¿‡ä½¿ç”¨æ³¨è§£æˆ–åŸºäº XML çš„é…ç½®äº‹åŠ¡ï¼Œä»è€Œäº‹åŠ¡ç®¡ç†ä¸ä¸šåŠ¡ä»£ç åˆ†ç¦»ã€‚
- **ç¼–ç¨‹å¼**äº‹åŠ¡ï¼šé€šè¿‡ç¼–ç çš„æ–¹å¼å®ç°äº‹åŠ¡ç®¡ç†ï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼çš„è°ƒç”¨äº‹åŠ¡çš„è·å¾—ã€æäº¤ã€å›æ»šã€‚å®ƒä¸ºæ‚¨æä¾›æå¤§çš„çµæ´»æ€§ï¼Œä½†ç»´æŠ¤èµ·æ¥éå¸¸å›°éš¾ã€‚



å®é™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Spring Boot + æ³¨è§£çš„**å£°æ˜å¼**äº‹åŠ¡ã€‚å¯ä»¥çœ‹çœ‹ [ã€ŠSpring Boot äº‹åŠ¡æ³¨è§£è¯¦è§£ã€‹](https://www.jianshu.com/p/cddeca2c9245) ã€‚

å¦å¤–ï¼Œä¹Ÿæ¨èçœ‹çœ‹ [ã€ŠSpring äº‹åŠ¡ç®¡ç† ï¼ ç¼–ç¨‹å¼äº‹åŠ¡ã€å£°æ˜å¼äº‹åŠ¡ã€‹](https://blog.csdn.net/xktxoo/article/details/77919508) ä¸€æ–‡ã€‚



## 44. Spring äº‹åŠ¡å¦‚ä½•å’Œä¸åŒçš„æ•°æ®æŒä¹…å±‚æ¡†æ¶åšé›†æˆï¼Ÿ

â‘  æ•°æ®æŒä¹…å±‚æ¡†æ¶ï¼ŒæŒ‡çš„æ˜¯ Spring JDBCã€Hibernateã€Spring JPAã€MyBatis ç­‰ã€‚

â‘¡ Spring äº‹åŠ¡æ˜¯é€šè¿‡ `org.springframework.transaction.PlatformTransactionManager` è¿›è¡Œç®¡ç†ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```java
public interface PlatformTransactionManager {
    // æ ¹æ®äº‹åŠ¡å®šä¹‰ TransactionDefinition ï¼Œè·å¾— TransactionStatus
    TransactionStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException;
    
    // æ ¹æ®æƒ…å†µï¼Œæäº¤äº‹åŠ¡
    void commit(TransactionStatus status) throws TransactionException;
    // æ ¹æ®æƒ…å†µï¼Œå›æ»šäº‹åŠ¡
    void rollback(TransactionStatus status) throws TransactionException;
}
```

- PlatformTransactionManager æ˜¯è´Ÿè´£äº‹åŠ¡ç®¡ç†çš„æ¥å£ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ¥å£æ–¹æ³•ï¼Œåˆ†åˆ«è´Ÿè´£äº‹åŠ¡çš„è·å¾—ã€æäº¤ã€å›æ»šã€‚

  - `#getTransaction(TransactionDefinition definition)` æ–¹æ³•ï¼Œæ ¹æ®äº‹åŠ¡å®šä¹‰ TransactionDefinition ï¼Œè·å¾— TransactionStatus ã€‚

  > - ä¸ºä»€ä¹ˆä¸æ˜¯åˆ›å»ºäº‹åŠ¡å‘¢ï¼Ÿå› ä¸ºå¦‚æœå½“å‰å¦‚æœå·²ç»æœ‰äº‹åŠ¡ï¼Œåˆ™ä¸ä¼šè¿›è¡Œåˆ›å»ºï¼Œä¸€èˆ¬æ¥è¯´ä¼šè·Ÿå½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®šã€‚å¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™è¿›è¡Œåˆ›å»ºã€‚
  > - ä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯ TransactionStatus å¯¹è±¡ï¼Ÿåœ¨ TransactionStatus ä¸­ï¼Œä¸ä»…ä»…åŒ…å«äº‹åŠ¡å±æ€§ï¼Œè¿˜åŒ…å«äº‹åŠ¡çš„å…¶å®ƒä¿¡æ¯ï¼Œä¾‹å¦‚æ˜¯å¦åªè¯»ã€æ˜¯å¦ä¸ºæ–°åˆ›å»ºçš„äº‹åŠ¡ç­‰ç­‰ã€‚ğŸ˜ˆ ä¸‹é¢ï¼Œä¹Ÿä¼šè¯¦ç»†è§£æ TransactionStatus ã€‚
  > - äº‹åŠ¡ TransactionDefinition æ˜¯ä»€ä¹ˆï¼ŸğŸ˜ˆ ä¸‹é¢ï¼Œä¹Ÿä¼šè¯¦ç»†è§£æ TransactionStatus ã€‚

  - `#commit(TransactionStatus status)` æ–¹æ³•ï¼Œæ ¹æ® TransactionStatus æƒ…å†µï¼Œæäº¤äº‹åŠ¡ã€‚

  > ä¸ºä»€ä¹ˆæ ¹æ® TransactionStatus æƒ…å†µï¼Œè¿›è¡Œæäº¤ï¼Ÿ
  >
  > ä¾‹å¦‚è¯´ï¼Œå¸¦@Transactional æ³¨è§£çš„çš„ A æ–¹æ³•ï¼Œä¼šè°ƒç”¨ @Transactional æ³¨è§£çš„çš„ B æ–¹æ³•ã€‚
  >
  > åœ¨ B æ–¹æ³•ç»“æŸè°ƒç”¨åï¼Œä¼šæ‰§è¡Œ PlatformTransactionManager#commit(TransactionStatus status) æ–¹æ³•ï¼Œæ­¤å¤„äº‹åŠ¡æ˜¯ä¸èƒ½ã€ä¹Ÿä¸ä¼šæäº¤çš„ã€‚è€Œæ˜¯åœ¨ A æ–¹æ³•ç»“æŸè°ƒç”¨åï¼Œæ‰§è¡Œ PlatformTransactionManager#commit(TransactionStatus status) æ–¹æ³•ï¼Œæäº¤äº‹åŠ¡ã€‚

  - `#rollback(TransactionStatus status)` æ–¹æ³•ï¼Œæ ¹æ® TransactionStatus æƒ…å†µï¼Œå›æ»šäº‹åŠ¡ã€‚

  > åŸå› åŒ `#commit(TransactionStatus status)` æ–¹æ³•ã€‚

â‘¢ PlatformTransactionManager æœ‰**æŠ½è±¡å­**ç±»

- `org.springframework.transaction.support.AbstractPlatformTransactionManager` ï¼ŒåŸºäº [æ¨¡æ¿æ–¹æ³•æ¨¡å¼](https://blog.csdn.net/carson_ho/article/details/54910518) ï¼Œå®ç°äº‹åŠ¡æ•´ä½“é€»è¾‘çš„éª¨æ¶ï¼Œè€ŒæŠ½è±¡ `#doCommit(DefaultTransactionStatus status)`ã€`#doRollback(DefaultTransactionStatus status)` ç­‰ç­‰æ–¹æ³•ï¼Œäº¤ç”±å­ç±»ç±»æ¥å®ç°ã€‚

â‘£ æœ€åï¼Œä¸åŒçš„æ•°æ®æŒä¹…å±‚æ¡†æ¶ï¼Œä¼šæœ‰å…¶å¯¹åº”çš„ PlatformTransactionManager å®ç°ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![äº‹åŠ¡çš„ç‰¹æ€§](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/07.jpeg)

- æ‰€æœ‰çš„å®ç°ç±»ï¼Œéƒ½åŸºäº AbstractPlatformTransactionManager è¿™ä¸ªéª¨æ¶ç±»ã€‚
  - HibernateTransactionManager ï¼Œå’Œ Hibernate5 çš„äº‹åŠ¡ç®¡ç†åšé›†æˆã€‚
  - DataSourceTransactionManager ï¼Œå’Œ JDBC çš„äº‹åŠ¡ç®¡ç†åšé›†æˆã€‚æ‰€ä»¥ï¼Œå®ƒä¹Ÿé€‚ç”¨äº MyBatisã€Spring JDBC ç­‰ç­‰ã€‚
  - JpaTransactionManager ï¼Œå’Œ JPA çš„äº‹åŠ¡ç®¡ç†åšé›†æˆã€‚


- å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ XML æ–¹å¼æ¥é…ç½®çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½¿ç”¨çš„æ˜¯ DataSourceTransactionManager ã€‚æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œå®ƒé€‚ç”¨äº MyBatisã€Spring JDBC ç­‰ç­‰ã€‚

```xml
<!-- äº‹åŠ¡ç®¡ç†å™¨ -->
<bean id="transactionManager"
class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <!-- æ•°æ®æº -->
    <property name="dataSource" ref="dataSource" />
</bean>
```

- æ›´å¤šè¯¦ç»†çš„è§£æï¼Œå¯è§å¦‚ä¸‹å‡ ç¯‡æ–‡ç« ï¼š

  - [ã€Šç²¾å°½ Spring æºç åˆ†æ â€”â€” Transaction æºç ç®€å•å¯¼è¯»ã€‹](http://svip.iocoder.cn/categories/Spring/)

  - [ã€Šç²¾å°½ MyBatis æºç åˆ†æ â€”â€” äº‹åŠ¡æ¨¡å—ã€‹](http://svip.iocoder.cn/MyBatis/transaction-package/)

  - [ã€Šç²¾å°½ MyBatis æºç è§£æ â€”â€” Spring é›†æˆï¼ˆå››ï¼‰ä¹‹äº‹åŠ¡ã€‹](http://svip.iocoder.cn/MyBatis/Spring-Integration-4/)


## 45. ä¸ºä»€ä¹ˆåœ¨ Spring äº‹åŠ¡ä¸­ä¸èƒ½åˆ‡æ¢æ•°æ®æºï¼Ÿ

åšè¿‡ Spring å¤šæ•°æ®æºçš„èƒ–å‹ï¼Œéƒ½ä¼šæœ‰ä¸ªæƒ¨ç—›çš„ç»å†ï¼Œä¸ºä»€ä¹ˆåœ¨å¼€å¯äº‹åŠ¡çš„ Service å±‚çš„æ–¹æ³•ä¸­ï¼Œæ— æ³•åˆ‡æ¢æ•°æ®æºå‘¢ï¼Ÿå› ä¸ºï¼Œåœ¨ Spring çš„äº‹åŠ¡ç®¡ç†ä¸­ï¼Œ**æ‰€ä½¿ç”¨çš„æ•°æ®åº“è¿æ¥ä¼šå’Œå½“å‰çº¿ç¨‹æ‰€ç»‘å®š**ï¼Œå³ä½¿æˆ‘ä»¬è®¾ç½®äº†å¦å¤–ä¸€ä¸ªæ•°æ®æºï¼Œä½¿ç”¨çš„è¿˜æ˜¯å½“å‰çš„æ•°æ®æºè¿æ¥ã€‚

å¦å¤–ï¼Œå¤šä¸ªæ•°æ®æºä¸”éœ€è¦äº‹åŠ¡çš„åœºæ™¯ï¼Œæœ¬èº«ä¼šå¸¦æ¥**å¤šäº‹åŠ¡ä¸€è‡´æ€§**çš„é—®é¢˜ï¼Œæš‚æ—¶æ²¡æœ‰ç‰¹åˆ«å¥½çš„è§£å†³æ–¹æ¡ˆã€‚

æ‰€ä»¥ä¸€èˆ¬ä¸€ä¸ªåº”ç”¨ï¼Œæ¨èé™¤éäº†è¯»å†™åˆ†ç¦»æ‰€å¸¦æ¥çš„å¤šæ•°æ®æºï¼Œå…¶å®ƒæƒ…å†µä¸‹ï¼Œå»ºè®®åªæœ‰ä¸€ä¸ªæ•°æ®æºã€‚å¹¶ä¸”ï¼Œéšç€å¾®æœåŠ¡æ—¥ç›Šèº«å½¢ï¼Œä¸€ä¸ªæœåŠ¡å¯¹åº”ä¸€ä¸ª DB æ˜¯æ¯”è¾ƒå¸¸è§çš„æ¶æ„é€‰æ‹©ã€‚



## 46. @Transactional æ³¨è§£æœ‰å“ªäº›å±æ€§ï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿ

- `@Transactional` æ³¨è§£çš„**å±æ€§**å¦‚ä¸‹ã€‚
  - ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `@Transactional` çš„æ‰€æœ‰å±æ€§é»˜è®¤å€¼å³å¯ã€‚

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/image-20220325223819438.png)



- `@Transactional` å¯ä»¥ä½œç”¨äºæ¥å£ã€æ¥å£æ–¹æ³•ã€ç±»åŠç±»æ–¹æ³•ä¸Šã€‚
  - å½“ä½œç”¨äºç±»ä¸Šæ—¶ï¼Œè¯¥ç±»çš„æ‰€æœ‰ `public` æ–¹æ³•å°†éƒ½å…·æœ‰è¯¥ç±»å‹çš„äº‹åŠ¡å±æ€§ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨è¯¥æ ‡æ³¨æ¥è¦†ç›–ç±»çº§åˆ«çš„å®šä¹‰ã€‚
  - è™½ç„¶ `@Transactional` æ³¨è§£å¯ä»¥ä½œç”¨äºæ¥å£ã€æ¥å£æ–¹æ³•ã€ç±»ä»¥åŠç±»æ–¹æ³•ä¸Šï¼Œä½†æ˜¯ Spring å»ºè®®ä¸è¦åœ¨æ¥å£æˆ–è€…æ¥å£æ–¹æ³•ä¸Šä½¿ç”¨è¯¥æ³¨è§£ï¼Œå› ä¸ºè¿™åªæœ‰åœ¨ä½¿ç”¨åŸºäºæ¥å£çš„ä»£ç†æ—¶å®ƒæ‰ä¼šç”Ÿæ•ˆã€‚
  - å¦å¤–ï¼Œ **`@Transactional` æ³¨è§£åº”è¯¥åªè¢«åº”ç”¨åˆ° `public` æ–¹æ³•ä¸Šï¼Œè¿™æ˜¯ç”± Spring AOP çš„æœ¬è´¨å†³å®šçš„**ã€‚å¦‚æœä½ åœ¨ `protected`ã€`private` æˆ–è€…é»˜è®¤å¯è§æ€§çš„æ–¹æ³•ä¸Šä½¿ç”¨ `@Transactional` æ³¨è§£ï¼Œè¿™å°†è¢«å¿½ç•¥ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚**è¿™ä¸€ç‚¹ï¼Œéå¸¸éœ€è¦æ³¨æ„**ã€‚


- `@Transactional` æ³¨è§£çš„å±æ€§ï¼Œä¼šè§£ææˆ `org.springframework.transaction.TransactionDefinition` å¯¹è±¡ï¼Œå³äº‹åŠ¡å®šä¹‰ã€‚ï¼ˆæºç ç›¸å…³ï¼‰

```java
public interface TransactionDefinition {

	int getPropagationBehavior(); // äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º
	int getIsolationLevel(); // äº‹åŠ¡çš„éš”ç¦»çº§åˆ«
	int getTimeout(); // äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´
	boolean isReadOnly(); // äº‹åŠ¡æ˜¯å¦åªè¯»
	@Nullable
	String getName(); // äº‹åŠ¡çš„åå­—
}
```

- `@Transactional` æ³¨è§£çš„`rollbackFor`ã€`rollbackForClassName`ã€`noRollbackFor`ã€`noRollbackForClassName` å±æ€§è²Œä¼¼æ²¡ä½“ç°å‡ºæ¥ï¼Ÿå®ƒä»¬ä½“ç°åœ¨ TransactionDefinition çš„å®ç°ç±» RuleBasedTransactionAttribute ä¸­ã€‚
- `#getPropagationBehavior()` æ–¹æ³•ï¼Œè¿”å›äº‹åŠ¡çš„**ä¼ æ’­è¡Œä¸º**ï¼Œè¯¥å€¼æ˜¯ä¸ªæšä¸¾ï¼Œåœ¨ä¸‹é¢æ¥è¯´ã€‚
- `#getIsolationLevel()` æ–¹æ³•ï¼Œè¿”å›äº‹åŠ¡çš„**éš”ç¦»çº§åˆ«**ï¼Œè¯¥å€¼æ˜¯ä¸ªæšä¸¾ï¼Œåœ¨ä¸‹é¢æ¥è¯´ã€‚



## 47. ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿåˆ†æˆå“ªäº›éš”ç¦»çº§åˆ«ï¼Ÿ

- [ã€Šæ•°æ®åº“å››å¤§ç‰¹æ€§ä»¥åŠäº‹åŠ¡éš”ç¦»çº§åˆ«ã€‹](https://zhuanlan.zhihu.com/p/25419593)
- [ã€Šäº”åˆ†é’Ÿææ¸…æ¥š MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‹](https://www.jianshu.com/p/4e3edbedb9a8)

ä¸åŒæ•°æ®åº“å¯¹å››ä¸ªéš”ç¦»çº§åˆ«çš„æ”¯æŒå’Œå®ç°ç•¥æœ‰ä¸åŒã€‚è‡³å°‘è¦ææ‡‚ MySQL å¯¹éš”ç¦»çº§åˆ«çš„æ”¯æŒå’Œå®ç°æƒ…å†µã€‚

åœ¨ TransactionDefinition æ¥å£ä¸­ï¼Œå®šä¹‰äº†â€œ**å››ç§**â€çš„éš”ç¦»çº§åˆ«æšä¸¾ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
/**
 * ã€Spring ç‹¬æœ‰ã€‘ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«
 * MySQL é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ«
 * Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«
 */
int ISOLATION_DEFAULT = -1;

// æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»
int ISOLATION_READ_UNCOMMITTED = Connection.TRANSACTION_READ_UNCOMMITTED;

// å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ
int ISOLATION_READ_COMMITTED = Connection.TRANSACTION_READ_COMMITTED;

// å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚
int ISOLATION_REPEATABLE_READ = Connection.TRANSACTION_REPEATABLE_READ;
/**
 * æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚
 *
 * ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚
 */
int ISOLATION_SERIALIZABLE = Connection.TRANSACTION_SERIALIZABLE;
```



## 48. ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼Ÿåˆ†æˆå“ªäº›ä¼ æ’­çº§åˆ«ï¼Ÿ

äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼ŒæŒ‡çš„æ˜¯å½“å‰å¸¦æœ‰äº‹åŠ¡é…ç½®çš„æ–¹æ³•ï¼Œéœ€è¦æ€ä¹ˆå¤„ç†äº‹åŠ¡ã€‚

 

- ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚
- æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œäº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼Œå¹¶ä¸æ˜¯æ•°æ®åº“äº‹åŠ¡è§„èŒƒä¸­çš„åè¯ï¼Œ**è€Œæ˜¯ Spring è‡ªèº«æ‰€å®šä¹‰çš„**ã€‚é€šè¿‡äº‹åŠ¡çš„ä¼ æ’­çº§åˆ«ï¼ŒSpring æ‰çŸ¥é“å¦‚ä½•å¤„ç†äº‹åŠ¡ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡å‘¢ï¼Œè¿˜æ˜¯ç»§ç»­ä½¿ç”¨å½“å‰çš„äº‹åŠ¡ã€‚

```java
// åœ¨ TransactionDefinition æ¥å£ä¸­ï¼Œå®šä¹‰äº†ä¸‰ç±»ä¸ƒç§ä¼ æ’­çº§åˆ«ã€‚ 

// ========== æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µ ========== 
/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨è¯¥äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚
 */
int PROPAGATION_REQUIRED = 0;
/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨è¯¥äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚
 */
int PROPAGATION_SUPPORTS = 1;
/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨è¯¥äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
 */
int PROPAGATION_MANDATORY = 2;

// ========== ä¸æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µ ========== 
/**
 * åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
 */
int PROPAGATION_REQUIRES_NEW = 3;
/**
 * ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œã€‚
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
 */
int PROPAGATION_NOT_SUPPORTED = 4;
/**
 * ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œã€‚
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
 */
int PROPAGATION_NEVER = 5;

// ========== å…¶ä»–æƒ…å†µ ========== 
/**
 * å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œã€‚
 * å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ç­‰ä»·äº {@link TransactionDefinition#PROPAGATION_REQUIRED}
 */
int PROPAGATION_NESTED = 6;
```



- åˆ†ç±»ä¹‹åï¼Œå…¶å®è¿˜æ˜¯æ¯”è¾ƒå¥½è®°çš„ã€‚ç»å¤§æ•°åœºæ™¯ï¼Œæˆ‘ä»¬åªç”¨ `PROPAGATION_REQUIRED` ä¼ æ’­çº§åˆ«ã€‚

- è¿™é‡Œéœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå‰é¢çš„å…­ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ Spring ä» EJB ä¸­å¼•å…¥çš„ï¼Œä»–ä»¬å…±äº«ç›¸åŒçš„æ¦‚å¿µã€‚è€Œ `PROPAGATION_NESTED` æ˜¯ Spring æ‰€ç‰¹æœ‰çš„ã€‚

> - ä»¥ `PROPAGATION_NESTED` å¯åŠ¨çš„äº‹åŠ¡å†…åµŒäºå¤–éƒ¨äº‹åŠ¡ä¸­ï¼ˆå¦‚æœå­˜åœ¨å¤–éƒ¨äº‹åŠ¡çš„è¯ï¼‰ï¼Œæ­¤æ—¶ï¼Œå†…åµŒäº‹åŠ¡å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ï¼Œå®ƒä¾èµ–äºå¤–éƒ¨äº‹åŠ¡çš„å­˜åœ¨ï¼Œåªæœ‰é€šè¿‡å¤–éƒ¨çš„äº‹åŠ¡æäº¤ï¼Œæ‰èƒ½å¼•èµ·å†…éƒ¨äº‹åŠ¡çš„æäº¤ï¼ŒåµŒå¥—çš„å­äº‹åŠ¡ä¸èƒ½å•ç‹¬æäº¤ã€‚å¦‚æœç†Ÿæ‚‰ JDBC ä¸­çš„ä¿å­˜ç‚¹ï¼ˆSavePointï¼‰çš„æ¦‚å¿µï¼Œé‚£åµŒå¥—äº‹åŠ¡å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå…¶å®åµŒå¥—çš„å­äº‹åŠ¡å°±æ˜¯ä¿å­˜ç‚¹çš„ä¸€ä¸ªåº”ç”¨ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªä¿å­˜ç‚¹ï¼Œæ¯ä¸€ä¸ªåµŒå¥—å­äº‹åŠ¡ã€‚å¦å¤–ï¼Œå¤–éƒ¨äº‹åŠ¡çš„å›æ»šä¹Ÿä¼šå¯¼è‡´åµŒå¥—å­äº‹åŠ¡çš„å›æ»šã€‚
> - ğŸ˜ˆ å½“ç„¶ï¼Œè™½ç„¶ä¸Šé¢ `PROPAGATION_NESTED` æ–‡å­—å¾ˆé•¿ï¼Œå®é™…æˆ‘ä»¬åŸºæœ¬æ²¡ç”¨è¿‡ã€‚æˆ–è€…è¯´ï¼Œå»æ‰åŸºæœ¬ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡ç”¨è¿‡ã€‚



## 49. ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„è¶…æ—¶å±æ€§ï¼Ÿ

æ‰€è°“äº‹åŠ¡è¶…æ—¶ï¼Œå°±æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰€å…è®¸æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚

åœ¨ TransactionDefinition ä¸­ä»¥ `int` çš„å€¼æ¥è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå…¶å•ä½æ˜¯ç§’ã€‚

è¿™ä¸ªå±æ€§ï¼Œè²Œä¼¼æˆ‘ä»¬åŸºæœ¬ä¹Ÿæ²¡ç”¨è¿‡ã€‚



## 50. ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„åªè¯»å±æ€§ï¼Ÿ

äº‹åŠ¡çš„åªè¯»å±æ€§æ˜¯æŒ‡ï¼Œå¯¹äº‹åŠ¡æ€§èµ„æºè¿›è¡Œåªè¯»æ“ä½œæˆ–è€…æ˜¯è¯»å†™æ“ä½œã€‚

- æ‰€è°“äº‹åŠ¡æ€§èµ„æºå°±æ˜¯æŒ‡é‚£äº›è¢«äº‹åŠ¡ç®¡ç†çš„èµ„æºï¼Œæ¯”å¦‚æ•°æ®æºã€JMS èµ„æºï¼Œä»¥åŠè‡ªå®šä¹‰çš„äº‹åŠ¡æ€§èµ„æºç­‰ç­‰ã€‚
- å¦‚æœç¡®å®šåªå¯¹äº‹åŠ¡æ€§èµ„æºè¿›è¡Œåªè¯»æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†äº‹åŠ¡æ ‡å¿—ä¸ºåªè¯»çš„ï¼Œä»¥æé«˜äº‹åŠ¡å¤„ç†çš„æ€§èƒ½ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šä¸ä½¿ç”¨äº‹åŠ¡å’Œä½¿ç”¨åªè¯»äº‹åŠ¡çš„åŒºåˆ« ã€‹](https://my.oschina.net/uniquejava/blog/80954) ã€‚

åœ¨ TransactionDefinition ä¸­ä»¥ `boolean` ç±»å‹æ¥è¡¨ç¤ºè¯¥äº‹åŠ¡æ˜¯å¦åªè¯»ã€‚



## 51. ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„å›æ»šè§„åˆ™ï¼Ÿ

å›æ»šè§„åˆ™ï¼Œå®šä¹‰äº†å“ªäº›å¼‚å¸¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šè€Œå“ªäº›ä¸ä¼šã€‚

- é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸æ—¶æ‰ä¼šå›æ»šï¼Œè€Œåœ¨é‡åˆ°æ£€æŸ¥å‹å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šï¼ˆè¿™ä¸€è¡Œä¸ºä¸EJBçš„å›æ»šè¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼‰ã€‚
- ä½†æ˜¯ä½ å¯ä»¥å£°æ˜äº‹åŠ¡åœ¨é‡åˆ°ç‰¹å®šçš„æ£€æŸ¥å‹å¼‚å¸¸æ—¶åƒé‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸é‚£æ ·å›æ»šã€‚åŒæ ·ï¼Œä½ è¿˜å¯ä»¥å£°æ˜äº‹åŠ¡é‡åˆ°ç‰¹å®šçš„å¼‚å¸¸ä¸å›æ»šï¼Œå³ä½¿è¿™äº›å¼‚å¸¸æ˜¯è¿è¡ŒæœŸå¼‚å¸¸ã€‚



æ³¨æ„ï¼Œäº‹åŠ¡çš„å›æ»šè§„åˆ™ï¼Œå¹¶ä¸æ˜¯æ•°æ®åº“äº‹åŠ¡è§„èŒƒä¸­çš„åè¯ï¼Œ**è€Œæ˜¯ Spring è‡ªèº«æ‰€å®šä¹‰çš„**ã€‚



## 52. ç®€å•ä»‹ç» TransactionStatus ï¼Ÿ

TransactionStatus æ¥å£ï¼Œè®°å½•äº‹åŠ¡çš„çŠ¶æ€ï¼Œä¸ä»…ä»…åŒ…å«äº‹åŠ¡æœ¬èº«ï¼Œè¿˜åŒ…å«äº‹åŠ¡çš„å…¶å®ƒä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
public interface TransactionStatus extends SavepointManager, Flushable {
    /**
     * æ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„äº‹åŠ¡
     */
    boolean isNewTransaction();

    /**
     * æ˜¯å¦æœ‰ Savepoint
     *
     * åœ¨ {@link TransactionDefinition#PROPAGATION_NESTED} ä¼ æ’­çº§åˆ«ä½¿ç”¨ã€‚
     */
    boolean hasSavepoint();

    /**
     * è®¾ç½®ä¸ºåªå›æ»š
     */
    void setRollbackOnly();
    /**
     * æ˜¯å¦ä¸ºåªå›æ»š
     */
    boolean isRollbackOnly();

    /**
     * æ‰§è¡Œ flush æ“ä½œ
     */
    @Override
    void flush();

    /**
     * æ˜¯å¦äº‹åŠ¡å·²ç»å®Œæˆ
     */
    boolean isCompleted();
}
```



- ä¸ºä»€ä¹ˆæ²¡æœ‰äº‹åŠ¡å¯¹è±¡å‘¢ï¼Ÿåœ¨ TransactionStatus çš„å®ç°ç±» DefaultTransactionStatus ä¸­ï¼Œæœ‰ä¸ª `Object transaction` å±æ€§ï¼Œè¡¨ç¤ºäº‹åŠ¡å¯¹è±¡ã€‚
- `#isNewTransaction()` æ–¹æ³•ï¼Œè¡¨ç¤ºæ˜¯å¦æ˜¯æ–°åˆ›å»ºçš„äº‹åŠ¡ã€‚æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç­”æ¡ˆç»“åˆ [ã€ŒSpring äº‹åŠ¡å¦‚ä½•å’Œä¸åŒçš„æ•°æ®æŒä¹…å±‚æ¡†æ¶åšé›†æˆï¼Ÿã€](http://svip.iocoder.cn/Spring/Interview/#) é—®é¢˜ï¼Œæˆ‘ä»¬å¯¹ `#commit(TransactionStatus status)` æ–¹æ³•çš„è§£é‡Šã€‚é€šè¿‡è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­ï¼Œå½“å‰äº‹åŠ¡æ˜¯å¦å½“å‰æ–¹æ³•æ‰€åˆ›å»ºçš„ï¼Œåªæœ‰åˆ›å»ºäº‹åŠ¡çš„æ–¹æ³•ï¼Œ**æ‰èƒ½ä¸”åº”è¯¥çœŸæ­£çš„æäº¤äº‹åŠ¡**ã€‚

## 53. ä½¿ç”¨ Spring äº‹åŠ¡æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ

- é€šè¿‡ PlatformTransactionManager ï¼Œä¸ºä¸åŒçš„æ•°æ®å±‚æŒä¹…æ¡†æ¶æä¾›ç»Ÿä¸€çš„ API ï¼Œæ— éœ€å…³å¿ƒåˆ°åº•æ˜¯åŸç”Ÿ JDBCã€Spring JDBCã€JPAã€Hibernate è¿˜æ˜¯ MyBatis ã€‚

- é€šè¿‡ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡ï¼Œä½¿ä¸šåŠ¡ä»£ç å’Œäº‹åŠ¡ç®¡ç†çš„é€»è¾‘åˆ†ç¦»ï¼Œæ›´åŠ æ¸…æ™°ã€‚

ä»å€¾å‘ä¸Šæ¥è¯´ï¼Œæ¯”è¾ƒå–œæ¬¢**æ³¨è§£** + å£°æ˜å¼äº‹åŠ¡ã€‚



# ä¸ƒã€Spring Data Access

## 54. Spring æ”¯æŒå“ªäº› ORM æ¡†æ¶ï¼Ÿ

- Hibernate
- JPA
- MyBatis
- [JDO](https://docs.spring.io/spring/docs/3.0.0.M4/reference/html/ch13s04.html)
- [OJB](https://db.apache.org/ojb/docu/howtos/howto-use-spring.html)

ä¸æ˜¯åº”è¯¥è¿˜æœ‰ Spring JDBC å—ã€‚æ³¨æ„ï¼ŒSpring JDBC ä¸æ˜¯ ORM æ¡†æ¶ã€‚

## 55. åœ¨ Spring æ¡†æ¶ä¸­å¦‚ä½•æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ JDBC ï¼Ÿ

Spring æä¾›äº† Spring JDBC æ¡†æ¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ JDBC ã€‚

å¯¹äºå¼€å‘è€…ï¼Œåªéœ€è¦ä½¿ç”¨ `JdbcTemplate` ç±»ï¼Œå®ƒæä¾›äº†å¾ˆå¤šä¾¿åˆ©çš„æ–¹æ³•è§£å†³è¯¸å¦‚æŠŠæ•°æ®åº“æ•°æ®è½¬å˜æˆåŸºæœ¬æ•°æ®ç±»å‹æˆ–å¯¹è±¡ï¼Œæ‰§è¡Œå†™å¥½çš„æˆ–å¯è°ƒç”¨çš„æ•°æ®åº“æ“ä½œè¯­å¥ï¼Œæä¾›è‡ªå®šä¹‰çš„æ•°æ®é”™è¯¯å¤„ç†ã€‚

å¯ä»¥çœ‹çœ‹ [ã€ŠSpring JDBC è®¿é—®å…³ç³»å‹æ•°æ®åº“ã€‹](https://www.tianmaying.com/tutorial/spring-jdbc-data-accessing) æ–‡ç« ã€‚



## 56. Spring æ•°æ®æ•°æ®è®¿é—®å±‚æœ‰å“ªäº›å¼‚å¸¸ï¼Ÿ

é€šè¿‡ä½¿ç”¨ Spring æ•°æ®æ•°æ®è®¿é—®å±‚ï¼Œå®ƒç»Ÿä¸€äº†å„ä¸ªæ•°æ®æŒä¹…å±‚æ¡†æ¶çš„ä¸åŒå¼‚å¸¸ï¼Œç»Ÿä¸€è¿›è¡Œæä¾› 

`org.springframework.dao.DataAccessException` å¼‚å¸¸åŠå…¶å­ç±»ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://notes2021.oss-cn-beijing.aliyuncs.com/2021/09.jpg)



## 57 ä½¿ç”¨ Spring è®¿é—® Hibernate çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ

- ä½¿ç”¨ Hibernate æ¨¡æ¿å’Œå›è°ƒè¿›è¡Œæ§åˆ¶åè½¬ã€‚
- æ‰©å±• HibernateDAOSupport å¹¶åº”ç”¨ AOP æ‹¦æˆªå™¨èŠ‚ç‚¹ã€‚

> ä¸è¿‡æˆ‘è®°å¾—ï¼Œ12 å¹´æˆ‘ç”¨è¿‡ Spring JPA çš„æ–¹å¼ï¼Œæ“ä½œ Hibernate ã€‚å…·ä½“å¯å‚è€ƒ [ã€Šä¸€èµ·æ¥å­¦ SpringBoot 2.x | ç¬¬å…­ç¯‡ï¼šæ•´åˆ Spring Data JPAã€‹](http://www.iocoder.cn/Spring-Boot/battcn/v2-orm-jpa/) ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¥çœ‹ä¸€é“ [ã€ŠJPA è§„èŒƒä¸ ORM æ¡†æ¶ä¹‹é—´çš„å…³ç³»æ˜¯æ€æ ·çš„å‘¢ï¼Ÿã€‹](https://www.cnblogs.com/xiaoheike/p/5150553.html) ã€‚



# å…«ã€æœ€å

æ•´ç† Spring é¢è¯•é¢˜çš„è¿‡ç¨‹ä¸­ï¼ŒåˆæŠŠ Spring çš„çŸ¥è¯†ç‚¹åˆå¤ä¹ äº†ä¸€éã€‚æˆ‘çªç„¶æœ‰ç‚¹æƒ³å¿µï¼Œé‚£æœ¬è¢«æˆ‘ç¿»çƒ‚çš„ [ã€ŠSpring å®æˆ˜ã€‹](https://book.douban.com/subject/26767354/) ã€‚

å‚è€ƒä¸æ¨èå¦‚ä¸‹æ–‡ç« ï¼š


- Java æ¶æ„ [ã€ŠSpring é¢è¯•é¢˜ã€‹](https://yq.aliyun.com/articles/669702)
- æ°¸é¡º [ã€Šå½»åº•å¾æœ Spring AOP ä¹‹ç†è®ºç¯‡ã€‹](https://segmentfault.com/a/1190000007469968)
- é™Œä¸Šæ¡‘èŠ±å¼€èŠ± [ã€ŠJava é¢è¯•é¢˜é›†ï¼ˆä¸ƒï¼‰â€“ Springå¸¸è§é¢è¯•é—®é¢˜ã€‹](https://blog.csdn.net/u014079773/article/details/52453002)
- ä¸€äººæµ…é†‰ [ã€ŠSpring çš„ @Transactional æ³¨è§£è¯¦ç»†ç”¨æ³•ã€‹](https://www.cnblogs.com/yepei/p/4716112.html)
- dalaoyang [ã€ŠSpring é¢è¯•é¢˜ã€‹](https://juejin.im/post/5b065000f265da0de45235e6)























